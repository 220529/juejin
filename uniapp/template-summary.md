# Uniapp ä¼ä¸šçº§æ¨¡æ¿é¡¹ç›® - æ­å»ºæ€»ç»“

## ğŸ‰ é¡¹ç›®å·²åˆ›å»ºå®Œæˆï¼

ä½ç½®ï¼š`E:\github\juejin\uniapp-template`

---

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ ¸å¿ƒåŠŸèƒ½

#### 1.1 æ™ºèƒ½ Token ç®¡ç†
- âœ… è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼ˆå¯é…ç½®å¼€å…³ï¼‰
- âœ… å¹¶å‘æ§åˆ¶ï¼ˆå¤šä¸ªè¯·æ±‚åŒæ—¶åˆ·æ–°æ—¶åªæ‰§è¡Œä¸€æ¬¡ï¼‰
- âœ… è¯·æ±‚é˜Ÿåˆ—ï¼ˆåˆ·æ–°æœŸé—´çš„è¯·æ±‚è‡ªåŠ¨æ’é˜Ÿï¼‰
- âœ… é˜²é‡å¤è·³è½¬
- ğŸ“ æ–‡ä»¶ï¼š`src/auth/tokenManager.js`

#### 1.2 è¯·æ±‚å–æ¶ˆæœºåˆ¶ â­
- âœ… æ”¯æŒå–æ¶ˆå•ä¸ªè¯·æ±‚
- âœ… æ”¯æŒå–æ¶ˆæ‰€æœ‰è¯·æ±‚
- âœ… æ”¯æŒæŒ‰ URL å–æ¶ˆè¯·æ±‚
- âœ… é¡µé¢å¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆ
- âœ… é˜²é‡å¤è¯·æ±‚
- âœ… Loading ç®¡ç†ï¼ˆè®¡æ•°å™¨ï¼‰
- âœ… é”™è¯¯èŠ‚æµï¼ˆ1.5ç§’å†…ç›¸åŒé”™è¯¯åªæç¤ºä¸€æ¬¡ï¼‰
- ğŸ“ æ–‡ä»¶ï¼š`src/api/core/request.js`

#### 1.3 å¤šç¯å¢ƒåˆ‡æ¢
- âœ… æ”¯æŒ dev/prod/local ä¸‰ç§ç¯å¢ƒ
- âœ… çº¿ä¸Šç‰ˆæœ¬è‡ªåŠ¨é”å®š prod ç¯å¢ƒ
- âœ… ä½“éªŒç‰ˆ/å¼€å‘ç‰ˆå¯è‡ªç”±åˆ‡æ¢
- âœ… æ§åˆ¶å°å‘½ä»¤åˆ‡æ¢ï¼š`switchEnv('dev')`
- ğŸ“ æ–‡ä»¶ï¼š`src/utils/env.js`

#### 1.4 é¡µé¢ç¼“å­˜æœºåˆ¶
- âœ… è§£å†³ URL å‚æ•°é•¿åº¦é™åˆ¶
- âœ… è‡ªåŠ¨æ ¹æ®é¡µé¢è·¯å¾„ç”Ÿæˆç¼“å­˜ key
- âœ… æ”¯æŒæ‰‹åŠ¨æ¸…ç†
- ğŸ“ æ–‡ä»¶ï¼š`src/utils/cache.js`

---

### 2. å·¥ç¨‹åŒ–é…ç½®

#### 2.1 ä»£ç è§„èŒƒ
- âœ… ESLintï¼ˆVue3 + ES6 è§„åˆ™é›†ï¼‰
- âœ… Prettierï¼ˆç»Ÿä¸€ä»£ç é£æ ¼ï¼‰
- âœ… é…ç½®æ–‡ä»¶ï¼š`eslint.config.js`ã€`.prettierrc`

#### 2.2 Git è§„èŒƒ
- âœ… Huskyï¼ˆGit Hooksï¼‰
- âœ… lint-stagedï¼ˆåªæ£€æŸ¥æš‚å­˜æ–‡ä»¶ï¼‰
- âœ… Commitizenï¼ˆä¸­æ–‡æç¤ºçš„æäº¤å·¥å…·ï¼‰
- âœ… Commitlintï¼ˆæäº¤ä¿¡æ¯éªŒè¯ï¼‰
- ğŸ“ æ–‡ä»¶ï¼š`.husky/pre-commit`ã€`.husky/commit-msg`

#### 2.3 åŒ…ç®¡ç†å™¨
- âœ… pnpmï¼ˆå¿«é€Ÿã€èŠ‚çœç©ºé—´ï¼‰
- âœ… ç‰ˆæœ¬é”å®šï¼š`pnpm@10.12.1`

---

### 3. é¡¹ç›®ç»“æ„

```
uniapp-template/
â”œâ”€â”€ .husky/                 # Git Hooks
â”‚   â”œâ”€â”€ pre-commit          # æäº¤å‰æ£€æŸ¥
â”‚   â””â”€â”€ commit-msg          # æäº¤ä¿¡æ¯éªŒè¯
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”‚   â””â”€â”€ å¼€å‘è§„èŒƒ.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                # æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ core/           # è¯·æ±‚æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ request.js  # è¯·æ±‚å°è£…ï¼ˆå¸¦å–æ¶ˆæœºåˆ¶ï¼‰â­
â”‚   â”‚   â”‚   â””â”€â”€ interceptors.js  # æ‹¦æˆªå™¨
â”‚   â”‚   â””â”€â”€ user.js         # ä¸šåŠ¡æ¥å£ç¤ºä¾‹
â”‚   â”œâ”€â”€ auth/               # è®¤è¯æ¨¡å—
â”‚   â”‚   â””â”€â”€ tokenManager.js  # Token ç®¡ç†
â”‚   â”œâ”€â”€ components/         # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ token.js        # Token é…ç½®
â”‚   â”œâ”€â”€ pages/              # é¡µé¢
â”‚   â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ styles/             # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ variables.scss  # æ ·å¼å˜é‡
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ cache.js        # é¡µé¢ç¼“å­˜
â”‚   â”‚   â””â”€â”€ env.js          # ç¯å¢ƒç®¡ç†
â”‚   â”œâ”€â”€ App.vue
â”‚   â”œâ”€â”€ main.js
â”‚   â”œâ”€â”€ pages.json
â”‚   â””â”€â”€ manifest.json
â”œâ”€â”€ .cz-config.js           # Commitizen é…ç½®
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .prettierrc             # Prettier é…ç½®
â”œâ”€â”€ commitlint.config.js    # Commitlint é…ç½®
â”œâ”€â”€ eslint.config.js        # ESLint é…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ vite.config.js          # Vite é…ç½®
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–ï¼ˆå·²å®Œæˆï¼‰

```bash
cd E:\github\juejin\uniapp-template
pnpm install
```

### 2. å¯åŠ¨å¼€å‘

```bash
# å¾®ä¿¡å°ç¨‹åº
pnpm run dev:wx

# H5
pnpm run dev:h5
```

### 3. æ„å»ºç”Ÿäº§

```bash
# å¾®ä¿¡å°ç¨‹åº
pnpm run build:wx

# H5
pnpm run build:h5
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. å‘èµ·è¯·æ±‚

```javascript
import { userApi } from '@/api/user.js';

// æ™®é€šè¯·æ±‚
const res = await userApi.getUserInfo({ id: 123 });

// å–æ¶ˆå‰ä¸€ä¸ªç›¸åŒè¯·æ±‚ï¼ˆæœç´¢åœºæ™¯ï¼‰
const res = await userApi.searchUsers(
  { keyword: 'test' },
  { cancelPrevious: true }  // â­ è‡ªåŠ¨å–æ¶ˆå‰ä¸€ä¸ªè¯·æ±‚
);

// é™é»˜è¯·æ±‚ï¼ˆä¸æ˜¾ç¤ºé”™è¯¯ï¼‰
const res = await http.post('/api/analytics', data, {
  showError: false,
  loading: false,
});
```

### 2. é¡µé¢å¸è½½æ—¶å–æ¶ˆè¯·æ±‚

```vue
<script setup>
import { onUnmounted } from 'vue';
import { http } from '@/api/core/request.js';

onUnmounted(() => {
  // â­ å–æ¶ˆæŒ‡å®š URL çš„æ‰€æœ‰è¯·æ±‚
  http.cancelRequestsByUrl('/api/user/list');
});
</script>
```

### 3. ç¯å¢ƒåˆ‡æ¢

```javascript
// æ§åˆ¶å°æ‰§è¡Œ
switchEnv('dev')    // åˆ‡æ¢åˆ°æµ‹è¯•ç¯å¢ƒ
switchEnv('prod')   // åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
switchEnv('local')  // åˆ‡æ¢åˆ°æœ¬åœ°ç¯å¢ƒ
```

### 4. é¡µé¢ç¼“å­˜

```javascript
import { savePageCache, getPageCache } from '@/utils/cache.js';

// ä¿å­˜æ•°æ®
savePageCache('/pages/order/detail', { orderId: 123, items: [...] });

// è·å–æ•°æ®
const data = getPageCache('/pages/order/detail');
```

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›ç‚¹

### ç›¸æ¯”åŸé¡¹ç›®çš„æ”¹è¿›ï¼š

1. **è¯·æ±‚å–æ¶ˆæœºåˆ¶** â­â­â­â­â­
   - è§£å†³å†…å­˜æ³„æ¼é—®é¢˜
   - é¿å…æ•°æ®é”™ä¹±
   - èŠ‚çœæµé‡

2. **æ›´å®Œå–„çš„ Token ç®¡ç†**
   - å¹¶å‘æ§åˆ¶
   - è¯·æ±‚é˜Ÿåˆ—
   - é˜²é‡å¤è·³è½¬

3. **æ›´å¥½çš„å·¥ç¨‹åŒ–é…ç½®**
   - è‡ªåŠ¨åŒ–å·¥å…·é“¾
   - ä¸­æ–‡æç¤ºçš„æäº¤å·¥å…·
   - pnpm åŒ…ç®¡ç†å™¨

---

## ğŸ“š æ–‡æ¡£

- `README.md` - é¡¹ç›®è¯´æ˜
- `docs/å¼€å‘è§„èŒƒ.md` - å¼€å‘è§„èŒƒ

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```bash
# åº”ç”¨ä¿¡æ¯
VITE_APP_NAME=uniappæ¨¡æ¿é¡¹ç›®

# ç§Ÿæˆ·ä¿¡æ¯
VITE_TENANT_ID=1
VITE_LOGIN_USER_TYPE=3

# API åœ°å€
VITE_LOCAL_API_BASE_URL=http://localhost:3000
VITE_DEV_API_BASE_URL=https://api-dev.example.com
VITE_PROD_API_BASE_URL=https://api.example.com
```

### Token é…ç½®ï¼ˆsrc/config/token.jsï¼‰

```javascript
// æ˜¯å¦å¯ç”¨Tokenè‡ªåŠ¨åˆ·æ–°
export const AUTO_REFRESH_ENABLED = false;

// æå‰åˆ·æ–°æ—¶é—´(æ¯«ç§’)
export const BUFFER_TIME = 5 * 60 * 1000; // 5åˆ†é’Ÿ
```

---

## ğŸ–ï¸ æœ€ä½³å®è·µ

1. **è¯·æ±‚å–æ¶ˆ**ï¼šé¡µé¢å¸è½½æ—¶è®°å¾—å–æ¶ˆè¯·æ±‚
2. **ç¯å¢ƒåˆ‡æ¢**ï¼šçº¿ä¸Šç‰ˆæœ¬ä¼šè‡ªåŠ¨é”å®š prod ç¯å¢ƒ
3. **Token ç®¡ç†**ï¼šæ ¹æ®éœ€è¦å¼€å¯/å…³é—­è‡ªåŠ¨åˆ·æ–°
4. **é¡µé¢ç¼“å­˜**ï¼šå¤æ‚å‚æ•°ä½¿ç”¨ç¼“å­˜è€Œä¸æ˜¯ URL ä¼ é€’
5. **ä»£ç è§„èŒƒ**ï¼šä½¿ç”¨ `pnpm run commit` æäº¤ä»£ç 

---

## ğŸ‰ ä¸‹ä¸€æ­¥

### 1. ä¿®æ”¹é…ç½®

- ä¿®æ”¹ `.env` ä¸­çš„ API åœ°å€
- ä¿®æ”¹ `src/manifest.json` ä¸­çš„å°ç¨‹åº appid
- ä¿®æ”¹ `package.json` ä¸­çš„é¡¹ç›®åç§°

### 2. å¼€å‘ä¸šåŠ¡åŠŸèƒ½

- åœ¨ `src/pages/` ä¸­åˆ›å»ºé¡µé¢
- åœ¨ `src/api/` ä¸­åˆ›å»ºæ¥å£
- åœ¨ `src/components/` ä¸­åˆ›å»ºç»„ä»¶

### 3. æµ‹è¯•

```bash
# å¯åŠ¨å¼€å‘
pnpm run dev:wx

# åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€ dist/dev/mp-weixin
```

---

## ğŸ“Š å¯¹æ¯”æ€»ç»“

| åŠŸèƒ½ | åŸé¡¹ç›® | æ¨¡æ¿é¡¹ç›® |
|------|--------|----------|
| Token ç®¡ç† | âœ… | âœ… æ›´å®Œå–„ |
| ç¯å¢ƒåˆ‡æ¢ | âœ… | âœ… |
| è¯·æ±‚å–æ¶ˆ | âŒ | âœ… â­ |
| é¡µé¢ç¼“å­˜ | âœ… | âœ… |
| å·¥ç¨‹åŒ–é…ç½® | âœ… | âœ… æ›´å®Œå–„ |
| é”™è¯¯å¤„ç† | âœ… | âœ… |
| ä»£ç è§„èŒƒ | âœ… | âœ… |

---

**æ¨¡æ¿é¡¹ç›®å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼** ğŸ‰
