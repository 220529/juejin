# CPM å¾®ä¿¡å°ç¨‹åºæ¶æ„åˆ†ææŠ¥å‘Š

> ä½œä¸ºèµ„æ·±ä¸“å®¶è§†è§’ï¼Œå¯¹ cpm-wechat é¡¹ç›®çš„åŸºå»ºé…ç½®ã€ç¯å¢ƒåˆ‡æ¢ã€å¼€å‘é…ç½®ç­‰è¿›è¡Œå…¨é¢è¯„ä¼°

## ğŸ“Š æ€»ä½“è¯„åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜† (4.5/5)

è¿™æ˜¯ä¸€ä¸ª**å·¥ç¨‹åŒ–æˆç†Ÿåº¦è¾ƒé«˜**çš„ uniapp é¡¹ç›®ï¼Œå…·å¤‡å®Œå–„çš„åŸºå»ºé…ç½®å’Œè§„èŒƒåŒ–çš„å¼€å‘æµç¨‹ã€‚

---

## ğŸ¯ ä¸€ã€æ ¸å¿ƒäº®ç‚¹

### 1.1 æ™ºèƒ½ Token ç®¡ç†æœºåˆ¶ â˜…â˜…â˜…â˜…â˜…

**è®¾è®¡äº®ç‚¹ï¼š**
- âœ… **è‡ªåŠ¨åˆ·æ–°æœºåˆ¶**ï¼šToken å³å°†è¿‡æœŸæ—¶è‡ªåŠ¨åˆ·æ–°ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
- âœ… **å¹¶å‘æ§åˆ¶**ï¼šå¤šä¸ªè¯·æ±‚åŒæ—¶è§¦å‘åˆ·æ–°æ—¶ï¼Œåªæ‰§è¡Œä¸€æ¬¡åˆ·æ–°ï¼Œå…¶ä»–è¯·æ±‚è¿›å…¥ç­‰å¾…é˜Ÿåˆ—
- âœ… **è¯·æ±‚é˜Ÿåˆ—**ï¼šåˆ·æ–°æœŸé—´çš„è¯·æ±‚è‡ªåŠ¨æ’é˜Ÿï¼Œåˆ·æ–°æˆåŠŸåæ‰¹é‡é‡è¯•
- âœ… **é˜²é‡å¤è·³è½¬**ï¼šç™»å½•é¡µè·³è½¬å¸¦é˜²æŠ–æœºåˆ¶ï¼Œé¿å…å¤šæ¬¡è§¦å‘
- âœ… **å…¨å±€å¼€å…³**ï¼šé€šè¿‡ `config/token.js` ä¸€é”®å¼€å…³è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½

**ä»£ç è´¨é‡ï¼š**
```javascript
// tokenManager.js - æ ¸å¿ƒè®¾è®¡æ¨¡å¼
class TokenManager {
  refreshPromise = null;      // å•ä¾‹åˆ·æ–° Promise
  pendingQueue = [];          // ç­‰å¾…é˜Ÿåˆ—
  redirecting = false;        // é˜²é‡å¤è·³è½¬æ ‡å¿—
}
```

**ä¸“å®¶è¯„ä»·ï¼š**
è¿™æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§åˆ«çš„ Token ç®¡ç†æ–¹æ¡ˆ**ï¼Œè§£å†³äº†å¸¸è§çš„å¹¶å‘åˆ·æ–°ã€é‡å¤è·³è½¬ç­‰é—®é¢˜ã€‚è®¾è®¡æ€è·¯æ¸…æ™°ï¼Œä»£ç å¥å£®æ€§é«˜ã€‚

---

### 1.2 å¤šç¯å¢ƒåˆ‡æ¢æ–¹æ¡ˆ â˜…â˜…â˜…â˜…â˜…

**è®¾è®¡äº®ç‚¹ï¼š**
- âœ… **å››ç¯å¢ƒæ”¯æŒ**ï¼šdev(æµ‹è¯•)ã€staging(é¢„å‘)ã€prod(ç”Ÿäº§)ã€local(æœ¬åœ°è”è°ƒ)
- âœ… **æ™ºèƒ½ç¯å¢ƒé”å®š**ï¼šçº¿ä¸Šæ­£å¼ç‰ˆå¼ºåˆ¶é”å®š prod ç¯å¢ƒï¼Œä½“éªŒç‰ˆ/å¼€å‘ç‰ˆå¯è‡ªç”±åˆ‡æ¢
- âœ… **è°ƒè¯• Token æœºåˆ¶**ï¼šæœ¬åœ°ç¯å¢ƒè‡ªåŠ¨ä½¿ç”¨æµ‹è¯•ç¯å¢ƒçš„ Tokenï¼Œæ— éœ€é‡å¤ç™»å½•
- âœ… **å¤šç§åˆ‡æ¢æ–¹å¼**ï¼š
  - Storage æ‰‹åŠ¨ä¿®æ”¹ï¼ˆæ¨èæœ¬åœ°è”è°ƒï¼‰
  - æ§åˆ¶å°å‘½ä»¤åˆ‡æ¢ï¼ˆå¼€å‘è°ƒè¯•ï¼‰
  - è®¾ç½®é¡µé¢åˆ‡æ¢ï¼ˆä½“éªŒç‰ˆç”¨æˆ·ï¼‰

**ç¯å¢ƒé…ç½®ï¼š**
```javascript
// .env æ–‡ä»¶ - ç¯å¢ƒé…ç½®é›†ä¸­ç®¡ç†
VITE_LOCAL_API_BASE_URL=http://localhost:36003
VITE_DEV_API_BASE_URL=https://zs-test.ttjjerp.com
VITE_PROD_API_BASE_URL=https://zs.ttjjerp.com
VITE_STAGING_API_BASE_URL=https://zs-staging.ttjjerp.com
```

**ä¸“å®¶è¯„ä»·ï¼š**
ç¯å¢ƒåˆ‡æ¢æ–¹æ¡ˆ**éå¸¸å®Œå–„**ï¼Œç‰¹åˆ«æ˜¯è°ƒè¯• Token æœºåˆ¶å’Œç¯å¢ƒé”å®šç­–ç•¥ï¼Œä½“ç°äº†å¯¹å®é™…å¼€å‘åœºæ™¯çš„æ·±åˆ»ç†è§£ã€‚

---

### 1.3 é¡µé¢ç¼“å­˜æœºåˆ¶ â˜…â˜…â˜…â˜…â˜†

**è®¾è®¡äº®ç‚¹ï¼š**
- âœ… **è§£å†³ç—›ç‚¹**ï¼šé¿å… URL å‚æ•°è¿‡é•¿é—®é¢˜ï¼ˆå¾®ä¿¡å°ç¨‹åºæœ‰é•¿åº¦é™åˆ¶ï¼‰
- âœ… **è‡ªåŠ¨åŒ–**ï¼šæ ¹æ®é¡µé¢è·¯å¾„è‡ªåŠ¨ç”Ÿæˆç¼“å­˜ key
- âœ… **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ”¯æŒæ‰‹åŠ¨æ¸…ç†å’Œæ‰¹é‡æ¸…ç†
- âœ… **ä¸šåŠ¡éš”ç¦»**ï¼šä¸åŒé¡µé¢çš„ç¼“å­˜äº’ä¸å¹²æ‰°

**æ ¸å¿ƒ APIï¼š**
```javascript
// ä¿å­˜é¡µé¢æ•°æ®
savePageCache('/pages/order/detail', { orderId: 123, items: [...] })

// è·å–é¡µé¢æ•°æ®
const data = getPageCache('/pages/order/detail')

// æ¸…é™¤é¡µé¢ç¼“å­˜
clearPageCache('/pages/order/detail')
```

**ä¸“å®¶è¯„ä»·ï¼š**
è¿™æ˜¯ä¸€ä¸ª**å®ç”¨çš„å·¥ç¨‹åŒ–æ–¹æ¡ˆ**ï¼Œè§£å†³äº†å°ç¨‹åºå¼€å‘ä¸­çš„å®é™…ç—›ç‚¹ã€‚å»ºè®®å¢åŠ ç¼“å­˜è¿‡æœŸæ—¶é—´å’Œè‡ªåŠ¨æ¸…ç†æœºåˆ¶ã€‚

---

### 1.4 è¯·æ±‚æ‹¦æˆªå™¨è®¾è®¡ â˜…â˜…â˜…â˜…â˜…

**è®¾è®¡äº®ç‚¹ï¼š**
- âœ… **é˜²é‡å¤è¯·æ±‚**ï¼šç›¸åŒè¯·æ±‚è‡ªåŠ¨å»é‡ï¼ˆåŸºäº URL + Method + Dataï¼‰
- âœ… **Loading ç®¡ç†**ï¼šè‡ªåŠ¨æ˜¾ç¤º/éšè— loadingï¼Œæ”¯æŒè®¡æ•°å™¨é˜²æ­¢é—ªçƒ
- âœ… **é”™è¯¯èŠ‚æµ**ï¼šç›¸åŒé”™è¯¯ 1.5 ç§’å†…åªæç¤ºä¸€æ¬¡
- âœ… **é™é»˜é”™è¯¯**ï¼š401 ç­‰ç‰¹æ®Šé”™è¯¯ä¸æ˜¾ç¤º toastï¼Œé¿å…å¹²æ‰°ç”¨æˆ·
- âœ… **è‡ªåŠ¨é‡è¯•**ï¼šToken åˆ·æ–°åè‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚

**æ ¸å¿ƒé€»è¾‘ï¼š**
```javascript
// é˜²é‡å¤è¯·æ±‚
const requestKey = `${method}_${url}_${JSON.stringify(data)}`
if (pendingRequests.has(requestKey)) return

// Loading è®¡æ•°å™¨
let loadingCount = 0
const showLoading = () => loadingCount++
const hideLoading = () => loadingCount = Math.max(loadingCount - 1, 0)
```

**ä¸“å®¶è¯„ä»·ï¼š**
è¯·æ±‚æ‹¦æˆªå™¨è®¾è®¡**éå¸¸ä¸“ä¸š**ï¼Œè€ƒè™‘äº†å„ç§è¾¹ç•Œæƒ…å†µã€‚é˜²é‡å¤è¯·æ±‚å’Œ Loading è®¡æ•°å™¨æ˜¯äº®ç‚¹ã€‚

---

## ğŸ› ï¸ äºŒã€å·¥ç¨‹åŒ–é…ç½®

### 2.1 ä»£ç è§„èŒƒå·¥å…·é“¾ â˜…â˜…â˜…â˜…â˜…

**é…ç½®å®Œæ•´åº¦ï¼š**
- âœ… **ESLint**ï¼šä»£ç æ£€æŸ¥ï¼ˆVue3 + ES6 è§„åˆ™é›†ï¼‰
- âœ… **Prettier**ï¼šä»£ç æ ¼å¼åŒ–ï¼ˆç»Ÿä¸€é£æ ¼ï¼‰
- âœ… **Husky**ï¼šGit Hooks è‡ªåŠ¨åŒ–
- âœ… **lint-staged**ï¼šåªæ£€æŸ¥æš‚å­˜æ–‡ä»¶ï¼Œæå‡æ•ˆç‡
- âœ… **Commitlint**ï¼šæäº¤ä¿¡æ¯è§„èŒƒéªŒè¯
- âœ… **Commitizen**ï¼šä¸­æ–‡æç¤ºçš„æäº¤å·¥å…·

**è‡ªåŠ¨åŒ–æµç¨‹ï¼š**
```bash
git add .
pnpm run commit  # ä¸­æ–‡æç¤ºï¼Œé€‰æ‹©ç±»å‹
# â†“ è‡ªåŠ¨è§¦å‘
# 1. pre-commit: ESLint ä¿®å¤ + Prettier æ ¼å¼åŒ–
# 2. commit-msg: éªŒè¯æäº¤ä¿¡æ¯æ ¼å¼
# 3. æäº¤æˆåŠŸ
```

**ä¸“å®¶è¯„ä»·ï¼š**
å·¥å…·é“¾é…ç½®**éå¸¸å®Œå–„**ï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ï¼Œå›¢é˜Ÿåä½œå‹å¥½ã€‚ä¸­æ–‡æç¤ºçš„ commitizen é…ç½®æ˜¯åŠ åˆ†é¡¹ã€‚

---

### 2.2 æ„å»ºé…ç½® â˜…â˜…â˜…â˜…â˜†

**Vite é…ç½®äº®ç‚¹ï¼š**
```javascript
// vite.config.js
export default {
  plugins: [
    uni(),                    // uni-app æ’ä»¶
    AutoImport({              // è‡ªåŠ¨å¯¼å…¥ Vue API
      imports: ['vue', 'uni-app']
    }),
    VueSetupExtend()          // setup name è¯­æ³•ç³–
  ],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      'dayjs/esm/index': 'dayjs'  // è§£å†³ dayjs ESM å…¼å®¹é—®é¢˜
    }
  },
  
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@import "@/styles/variables.scss";`  // å…¨å±€æ ·å¼å˜é‡
      }
    }
  },
  
  build: {
    minify: 'esbuild',        // æ›´å¿«çš„æ„å»ºé€Ÿåº¦
    esbuild: {
      drop: ['console', 'debugger']  // ç”Ÿäº§ç¯å¢ƒç§»é™¤è°ƒè¯•ä»£ç 
    }
  }
}
```

**ä¸“å®¶è¯„ä»·ï¼š**
æ„å»ºé…ç½®**åˆç†ä¸”é«˜æ•ˆ**ï¼Œä½¿ç”¨ esbuild æå‡æ„å»ºé€Ÿåº¦ï¼Œå…¨å±€æ ·å¼å˜é‡æ³¨å…¥æ–¹ä¾¿ä¸»é¢˜å®šåˆ¶ã€‚

---

### 2.3 åŒ…ç®¡ç†å™¨ â˜…â˜…â˜…â˜…â˜…

**é€‰æ‹©ï¼špnpm**
- âœ… **ç£ç›˜æ•ˆç‡**ï¼šç¡¬é“¾æ¥æœºåˆ¶ï¼ŒèŠ‚çœç©ºé—´
- âœ… **å®‰è£…é€Ÿåº¦**ï¼šæ¯” npm/yarn å¿« 2-3 å€
- âœ… **ä¾èµ–ä¸¥æ ¼**ï¼šé¿å…å¹½çµä¾èµ–é—®é¢˜
- âœ… **Monorepo å‹å¥½**ï¼šé€‚åˆæœªæ¥æ‰©å±•

**ç‰ˆæœ¬é”å®šï¼š**
```json
"packageManager": "pnpm@10.12.1+sha512.f0dda..."
```

**ä¸“å®¶è¯„ä»·ï¼š**
é€‰æ‹© pnpm å¹¶é”å®šç‰ˆæœ¬æ˜¯**æœ€ä½³å®è·µ**ï¼Œä¿è¯å›¢é˜Ÿç¯å¢ƒä¸€è‡´æ€§ã€‚

---

## ğŸ“ ä¸‰ã€ç›®å½•ç»“æ„è®¾è®¡ â˜…â˜…â˜…â˜…â˜†

### 3.1 æ•´ä½“ç»“æ„

```
src/
â”œâ”€â”€ api/              # æ¥å£å±‚ï¼ˆæŒ‰ä¸šåŠ¡æ¨¡å—åˆ’åˆ†ï¼‰
â”‚   â”œâ”€â”€ core/         # è¯·æ±‚æ ¸å¿ƒï¼ˆæ‹¦æˆªå™¨ã€HTTP å®¢æˆ·ç«¯ï¼‰
â”‚   â”œâ”€â”€ auth.js       # è®¤è¯æ¥å£
â”‚   â”œâ”€â”€ project.js    # é¡¹ç›®æ¥å£
â”‚   â””â”€â”€ ...
â”œâ”€â”€ auth/             # è®¤è¯æ¨¡å—ï¼ˆToken ç®¡ç†ã€æƒé™æ§åˆ¶ï¼‰
â”‚   â”œâ”€â”€ tokenManager.js
â”‚   â”œâ”€â”€ config.js
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ components/       # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ ActionButton/
â”‚   â”œâ”€â”€ FileUpload/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ token.js      # Token é…ç½®
â”œâ”€â”€ enums/            # æšä¸¾å¸¸é‡
â”‚   â”œâ”€â”€ material.js
â”‚   â”œâ”€â”€ order.js
â”‚   â””â”€â”€ ...
â”œâ”€â”€ pages/            # é¡µé¢ï¼ˆä¸»åŒ…ï¼‰
â”‚   â”œâ”€â”€ login/
â”‚   â”œâ”€â”€ index/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ store/            # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ styles/           # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ variables.scss
â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ cache.js      # é¡µé¢ç¼“å­˜
â”‚   â”œâ”€â”€ env.js        # ç¯å¢ƒç®¡ç†
â”‚   â”œâ”€â”€ page.js       # é¡µé¢è·³è½¬
â”‚   â””â”€â”€ ...
â”œâ”€â”€ App.vue
â”œâ”€â”€ main.js
â”œâ”€â”€ pages.json        # é¡µé¢é…ç½®
â””â”€â”€ manifest.json     # åº”ç”¨é…ç½®
```

**ä¸“å®¶è¯„ä»·ï¼š**
ç›®å½•ç»“æ„**æ¸…æ™°åˆç†**ï¼ŒèŒè´£åˆ’åˆ†æ˜ç¡®ã€‚`auth/` å’Œ `api/core/` çš„ç‹¬ç«‹è®¾è®¡ä½“ç°äº†è‰¯å¥½çš„æ¶æ„æ€ç»´ã€‚

---

### 3.2 åˆ†åŒ…ç­–ç•¥ â˜…â˜…â˜…â˜…â˜†

**pages.json é…ç½®ï¼š**
```json
{
  "pages": [...],  // ä¸»åŒ…ï¼šç™»å½•ã€é¦–é¡µã€æˆ‘çš„
  "subPackages": [
    {
      "root": "pages/project-workflow",  // é¡¹ç›®å·¥ä½œæµ
      "pages": [...]
    },
    {
      "root": "pages/business",          // ä¸šåŠ¡æ¨¡å—
      "pages": [...]
    },
    {
      "root": "pages/tools",             // å·¥å…·é¡µé¢
      "independent": true,               // ç‹¬ç«‹åˆ†åŒ…
      "pages": [...]
    }
  ]
}
```

**ä¸“å®¶è¯„ä»·ï¼š**
åˆ†åŒ…ç­–ç•¥**åˆç†**ï¼Œç‹¬ç«‹åˆ†åŒ…çš„ä½¿ç”¨æ°å½“ã€‚å»ºè®®è¿›ä¸€æ­¥ä¼˜åŒ–ä¸»åŒ…å¤§å°ï¼Œå°†ä½é¢‘é¡µé¢ç§»è‡³åˆ†åŒ…ã€‚

---

## ğŸ” å››ã€å­˜åœ¨çš„é—®é¢˜ä¸æ”¹è¿›å»ºè®®

### 4.1 éœ€è¦æ”¹è¿›çš„åœ°æ–¹ âš ï¸

#### é—®é¢˜ 1ï¼šç¼ºå°‘ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
**ç°çŠ¶ï¼š**
- é”™è¯¯æç¤ºåˆ†æ•£åœ¨å„ä¸ªè¯·æ±‚ä¸­
- æ²¡æœ‰ç»Ÿä¸€çš„é”™è¯¯ç æ˜ å°„
- ç¼ºå°‘é”™è¯¯æ—¥å¿—ä¸ŠæŠ¥

**å»ºè®®ï¼š**
```javascript
// utils/errorHandler.js
export const ERROR_CODE_MAP = {
  1001: 'ç”¨æˆ·ä¸å­˜åœ¨',
  1002: 'å¯†ç é”™è¯¯',
  // ...
}

export function handleError(error) {
  const message = ERROR_CODE_MAP[error.code] || error.message
  uni.showToast({ title: message, icon: 'error' })
  
  // ä¸ŠæŠ¥é”™è¯¯æ—¥å¿—
  reportError(error)
}
```

---

#### é—®é¢˜ 2ï¼šç¼ºå°‘è¯·æ±‚å–æ¶ˆæœºåˆ¶
**ç°çŠ¶ï¼š**
- é¡µé¢è·³è½¬æ—¶ï¼Œæœªå–æ¶ˆè¿›è¡Œä¸­çš„è¯·æ±‚
- å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼å’Œä¸å¿…è¦çš„ç½‘ç»œæ¶ˆè€—

**å»ºè®®ï¼š**
```javascript
// ä½¿ç”¨ AbortController æˆ–è‡ªå®šä¹‰å–æ¶ˆæœºåˆ¶
const cancelTokenMap = new Map()

export function cancelRequest(url) {
  const cancel = cancelTokenMap.get(url)
  cancel && cancel()
}
```

---

#### é—®é¢˜ 3ï¼šç¼ºå°‘æ€§èƒ½ç›‘æ§
**ç°çŠ¶ï¼š**
- æ²¡æœ‰é¡µé¢åŠ è½½æ—¶é—´ç»Ÿè®¡
- æ²¡æœ‰æ¥å£å“åº”æ—¶é—´ç›‘æ§
- ç¼ºå°‘æ€§èƒ½ç“¶é¢ˆåˆ†æ

**å»ºè®®ï¼š**
```javascript
// utils/performance.js
export function trackPageLoad(pageName) {
  const startTime = Date.now()
  return () => {
    const duration = Date.now() - startTime
    reportPerformance({ pageName, duration })
  }
}
```

---

#### é—®é¢˜ 4ï¼šç¯å¢ƒå˜é‡ç®¡ç†å¯ä»¥æ›´ä¼˜é›…
**ç°çŠ¶ï¼š**
- `.env` æ–‡ä»¶åŒ…å«æ‰€æœ‰ç¯å¢ƒé…ç½®
- æ²¡æœ‰ `.env.development` / `.env.production` åˆ†ç¦»

**å»ºè®®ï¼š**
```bash
.env                 # é€šç”¨é…ç½®
.env.development     # å¼€å‘ç¯å¢ƒ
.env.production      # ç”Ÿäº§ç¯å¢ƒ
.env.local           # æœ¬åœ°è¦†ç›–ï¼ˆä¸æäº¤ï¼‰
```

---

#### é—®é¢˜ 5ï¼šç¼ºå°‘å•å…ƒæµ‹è¯•
**ç°çŠ¶ï¼š**
- æ²¡æœ‰ä»»ä½•æµ‹è¯•æ–‡ä»¶
- æ ¸å¿ƒå·¥å…·å‡½æ•°ï¼ˆå¦‚ tokenManagerã€cacheï¼‰æœªè¦†ç›–æµ‹è¯•

**å»ºè®®ï¼š**
```javascript
// tests/tokenManager.spec.js
describe('TokenManager', () => {
  it('should refresh token when expired', async () => {
    // ...
  })
})
```

---

### 4.2 å¯ä¼˜åŒ–çš„åœ°æ–¹ ğŸ’¡

#### ä¼˜åŒ– 1ï¼šç»„ä»¶è‡ªåŠ¨å¯¼å…¥
**å½“å‰ï¼š**
```javascript
import ActionButton from '@/components/ActionButton/index.vue'
```

**å»ºè®®ï¼š**
```javascript
// vite.config.js
import Components from 'unplugin-vue-components/vite'

plugins: [
  Components({
    dirs: ['src/components'],
    dts: 'src/components.d.ts'
  })
]

// ä½¿ç”¨æ—¶æ— éœ€å¯¼å…¥
<ActionButton />  // è‡ªåŠ¨è¯†åˆ«
```

---

#### ä¼˜åŒ– 2ï¼šAPI æ¥å£ç±»å‹å®šä¹‰
**å½“å‰ï¼š**
```javascript
export const projectApi = {
  getProjectList: (params) => http.post('/app-api/cpm/project/list', params)
}
```

**å»ºè®®ï¼š**
```typescript
// api/project.ts
interface ProjectListParams {
  page: number
  pageSize: number
}

interface ProjectListResponse {
  list: Project[]
  total: number
}

export const projectApi = {
  getProjectList: (params: ProjectListParams): Promise<ProjectListResponse> => {
    return http.post('/app-api/cpm/project/list', params)
  }
}
```

---

#### ä¼˜åŒ– 3ï¼šé¡µé¢ç¼“å­˜å¢åŠ è¿‡æœŸæ—¶é—´
**å½“å‰ï¼š**
```javascript
saveCache(key, data)  // æ°¸ä¹…ç¼“å­˜
```

**å»ºè®®ï¼š**
```javascript
saveCache(key, data, { ttl: 5 * 60 * 1000 })  // 5åˆ†é’Ÿè¿‡æœŸ

export const getCache = (key) => {
  const cache = uni.getStorageSync(key)
  if (cache && cache.expireTime < Date.now()) {
    clearCache(key)
    return null
  }
  return cache.data
}
```

---

#### ä¼˜åŒ– 4ï¼šè¯·æ±‚æ‹¦æˆªå™¨æ”¯æŒè¯·æ±‚ä¼˜å…ˆçº§
**å»ºè®®ï¼š**
```javascript
// é«˜ä¼˜å…ˆçº§è¯·æ±‚ï¼ˆå¦‚ç™»å½•ï¼‰ç«‹å³æ‰§è¡Œ
http.post('/login', data, { priority: 'high' })

// ä½ä¼˜å…ˆçº§è¯·æ±‚ï¼ˆå¦‚ç»Ÿè®¡ï¼‰å¯å»¶è¿Ÿ
http.post('/analytics', data, { priority: 'low' })
```

---

## ğŸ“Š äº”ã€æ¨¡æ¿åŒ–å»ºè®®

### 5.1 å¯ä»¥ç›´æ¥å¤ç”¨çš„éƒ¨åˆ† âœ…

1. **å®Œæ•´çš„å·¥ç¨‹åŒ–é…ç½®**
   - `.eslintrc.js` / `eslint.config.js`
   - `.prettierrc`
   - `.cz-config.js`
   - `commitlint.config.js`
   - `.husky/` é’©å­é…ç½®
   - `package.json` è„šæœ¬å‘½ä»¤

2. **æ ¸å¿ƒå·¥å…·æ¨¡å—**
   - `auth/tokenManager.js` - Token ç®¡ç†
   - `utils/env.js` - ç¯å¢ƒç®¡ç†
   - `utils/cache.js` - é¡µé¢ç¼“å­˜
   - `utils/page.js` - é¡µé¢è·³è½¬
   - `api/core/` - è¯·æ±‚æ ¸å¿ƒ

3. **Vite é…ç½®**
   - `vite.config.js` å®Œæ•´é…ç½®
   - è‡ªåŠ¨å¯¼å…¥ã€åˆ«åã€æ ·å¼é¢„å¤„ç†

4. **ç›®å½•ç»“æ„**
   - æ•´ä½“ç›®å½•åˆ’åˆ†
   - åˆ†åŒ…ç­–ç•¥

---

### 5.2 éœ€è¦æ ¹æ®é¡¹ç›®è°ƒæ•´çš„éƒ¨åˆ† âš™ï¸

1. **ä¸šåŠ¡ç›¸å…³**
   - `api/` ä¸‹çš„ä¸šåŠ¡æ¥å£
   - `pages/` é¡µé¢æ–‡ä»¶
   - `components/` ä¸šåŠ¡ç»„ä»¶
   - `enums/` æšä¸¾å¸¸é‡
   - `store/` çŠ¶æ€ç®¡ç†

2. **é…ç½®ç›¸å…³**
   - `.env` ç¯å¢ƒå˜é‡ï¼ˆAPI åœ°å€ã€ç§Ÿæˆ· ID ç­‰ï¼‰
   - `manifest.json` å°ç¨‹åº appid
   - `pages.json` é¡µé¢è·¯ç”±é…ç½®

3. **æ ·å¼ç›¸å…³**
   - `styles/variables.scss` ä¸»é¢˜å˜é‡
   - `uni.scss` å…¨å±€æ ·å¼

---

### 5.3 æ¨¡æ¿åŒ–æ¸…å• ğŸ“‹

**åˆ›å»ºæ–°é¡¹ç›®æ—¶çš„æ­¥éª¤ï¼š**

```bash
# 1. å¤åˆ¶é¡¹ç›®ç»“æ„
cp -r cpm-wechat new-project

# 2. æ¸…ç†ä¸šåŠ¡ä»£ç 
rm -rf src/pages/*        # åˆ é™¤ä¸šåŠ¡é¡µé¢
rm -rf src/api/*.js       # ä¿ç•™ core/ï¼Œåˆ é™¤ä¸šåŠ¡æ¥å£
rm -rf src/components/*   # åˆ é™¤ä¸šåŠ¡ç»„ä»¶

# 3. ä¿ç•™æ ¸å¿ƒæ¨¡å—
# âœ… auth/
# âœ… utils/
# âœ… api/core/
# âœ… config/
# âœ… æ‰€æœ‰é…ç½®æ–‡ä»¶

# 4. ä¿®æ”¹é…ç½®
# - .env ç¯å¢ƒå˜é‡
# - manifest.json appid
# - package.json name/version

# 5. å®‰è£…ä¾èµ–
pnpm install

# 6. å¼€å§‹å¼€å‘
pnpm run dev:wx
```

---

## ğŸ¯ å…­ã€æ€»ä½“è¯„ä»·

### 6.1 ä¼˜åŠ¿æ€»ç»“ âœ¨

1. **å·¥ç¨‹åŒ–æˆç†Ÿåº¦é«˜**ï¼šå®Œæ•´çš„ä»£ç è§„èŒƒã€è‡ªåŠ¨åŒ–å·¥å…·é“¾
2. **æ ¸å¿ƒåŠŸèƒ½è®¾è®¡ä¼˜ç§€**ï¼šToken ç®¡ç†ã€ç¯å¢ƒåˆ‡æ¢ã€è¯·æ±‚æ‹¦æˆªå™¨
3. **å¼€å‘ä½“éªŒå¥½**ï¼šè‡ªåŠ¨å¯¼å…¥ã€ä¸­æ–‡æç¤ºã€çƒ­æ›´æ–°
4. **å›¢é˜Ÿåä½œå‹å¥½**ï¼šç»Ÿä¸€è§„èŒƒã€Git Hooksã€æ–‡æ¡£å®Œå–„
5. **å¯ç»´æŠ¤æ€§å¼º**ï¼šç›®å½•æ¸…æ™°ã€èŒè´£æ˜ç¡®ã€ä»£ç è§„èŒƒ

---

### 6.2 é€‚åˆä½œä¸ºæ¨¡æ¿çš„ç†ç”± ğŸ–ï¸

1. âœ… **åŸºå»ºå®Œå–„**ï¼šå·¥ç¨‹åŒ–é…ç½®é½å…¨ï¼Œå¼€ç®±å³ç”¨
2. âœ… **æ¶æ„æ¸…æ™°**ï¼šç›®å½•ç»“æ„åˆç†ï¼Œæ˜“äºæ‰©å±•
3. âœ… **æ ¸å¿ƒåŠŸèƒ½å¼ºå¤§**ï¼šToken ç®¡ç†ã€ç¯å¢ƒåˆ‡æ¢ç­‰é€šç”¨éœ€æ±‚å·²è§£å†³
4. âœ… **æ–‡æ¡£é½å…¨**ï¼šREADMEã€å¼€å‘è§„èŒƒã€æœ¬åœ°è”è°ƒè¯´æ˜
5. âœ… **å®æˆ˜éªŒè¯**ï¼šå·²åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œï¼Œç¨³å®šæ€§æœ‰ä¿éšœ

---

### 6.3 æ”¹è¿›ä¼˜å…ˆçº§ ğŸ”¥

**é«˜ä¼˜å…ˆçº§ï¼ˆå»ºè®®ç«‹å³æ”¹è¿›ï¼‰ï¼š**
1. å¢åŠ å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒå·¥å…·å‡½æ•°ï¼‰
2. å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶
3. å¢åŠ è¯·æ±‚å–æ¶ˆæœºåˆ¶

**ä¸­ä¼˜å…ˆçº§ï¼ˆå¯é€æ­¥ä¼˜åŒ–ï¼‰ï¼š**
1. ç¯å¢ƒå˜é‡æ–‡ä»¶åˆ†ç¦»
2. ç»„ä»¶è‡ªåŠ¨å¯¼å…¥
3. API æ¥å£ç±»å‹å®šä¹‰ï¼ˆTypeScriptï¼‰

**ä½ä¼˜å…ˆçº§ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰ï¼š**
1. æ€§èƒ½ç›‘æ§
2. è¯·æ±‚ä¼˜å…ˆçº§
3. é¡µé¢ç¼“å­˜è¿‡æœŸæ—¶é—´

---

## ğŸ“ ä¸ƒã€æ¨¡æ¿åŒ–å®æ–½æ–¹æ¡ˆ

### 7.1 åˆ›å»ºæ¨¡æ¿ä»“åº“

**æ­¥éª¤ï¼š**
1. åˆ›å»ºæ–°ä»“åº“ `uniapp-template`
2. å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶ï¼ˆè§ 5.3 æ¸…å•ï¼‰
3. ç¼–å†™æ¨¡æ¿ä½¿ç”¨æ–‡æ¡£
4. æä¾›åˆå§‹åŒ–è„šæœ¬

**åˆå§‹åŒ–è„šæœ¬ç¤ºä¾‹ï¼š**
```bash
#!/bin/bash
# init-project.sh

echo "è¯·è¾“å…¥é¡¹ç›®åç§°ï¼š"
read PROJECT_NAME

echo "è¯·è¾“å…¥å°ç¨‹åº AppIDï¼š"
read APP_ID

# æ›¿æ¢é…ç½®
sed -i "s/cpm-wechat/$PROJECT_NAME/g" package.json
sed -i "s/wx12d76246c485f240/$APP_ID/g" src/manifest.json

echo "âœ… é¡¹ç›®åˆå§‹åŒ–å®Œæˆï¼"
echo "ğŸ“¦ è¯·è¿è¡Œ: pnpm install"
```

---

### 7.2 æ¨¡æ¿æ–‡æ¡£ç»“æ„

```
uniapp-template/
â”œâ”€â”€ README.md                    # æ¨¡æ¿è¯´æ˜
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ å¿«é€Ÿå¼€å§‹.md
â”‚   â”œâ”€â”€ æ ¸å¿ƒåŠŸèƒ½è¯´æ˜.md
â”‚   â”‚   â”œâ”€â”€ Tokenç®¡ç†.md
â”‚   â”‚   â”œâ”€â”€ ç¯å¢ƒåˆ‡æ¢.md
â”‚   â”‚   â””â”€â”€ é¡µé¢ç¼“å­˜.md
â”‚   â”œâ”€â”€ å¼€å‘è§„èŒƒ.md
â”‚   â””â”€â”€ å¸¸è§é—®é¢˜.md
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-project.sh          # åˆå§‹åŒ–è„šæœ¬
â””â”€â”€ src/                         # æºç 
```

---

### 7.3 ä½¿ç”¨æµç¨‹

```bash
# 1. å…‹éš†æ¨¡æ¿
git clone https://github.com/your-org/uniapp-template.git my-project

# 2. åˆå§‹åŒ–é¡¹ç›®
cd my-project
./scripts/init-project.sh

# 3. å®‰è£…ä¾èµ–
pnpm install

# 4. é…ç½®ç¯å¢ƒå˜é‡
# ç¼–è¾‘ .env æ–‡ä»¶

# 5. å¯åŠ¨å¼€å‘
pnpm run dev:wx
```

---

## ğŸ† å…«ã€æœ€ç»ˆå»ºè®®

### ä½œä¸ºæ¨¡æ¿ä½¿ç”¨çš„ä»·å€¼ï¼šâ˜…â˜…â˜…â˜…â˜…

è¿™ä¸ªé¡¹ç›®**éå¸¸é€‚åˆä½œä¸ºæ¨¡æ¿**ï¼ŒåŸå› å¦‚ä¸‹ï¼š

1. **èŠ‚çœæ—¶é—´**ï¼šåŸºå»ºé…ç½®å®Œå–„ï¼Œæ–°é¡¹ç›®å¯èŠ‚çœ 2-3 å¤©æ­å»ºæ—¶é—´
2. **é™ä½é£é™©**ï¼šæ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ï¼Œé¿å…è¸©å‘
3. **ç»Ÿä¸€è§„èŒƒ**ï¼šå›¢é˜Ÿä½¿ç”¨åŒä¸€æ¨¡æ¿ï¼Œä»£ç é£æ ¼ä¸€è‡´
4. **æ˜“äºç»´æŠ¤**ï¼šæ¶æ„æ¸…æ™°ï¼Œåç»­ç»´æŠ¤æˆæœ¬ä½
5. **æŒç»­ä¼˜åŒ–**ï¼šæ¨¡æ¿å¯æŒç»­è¿­ä»£ï¼Œæ‰€æœ‰é¡¹ç›®å—ç›Š

### æ”¹è¿›åçš„æ¨¡æ¿è¯„åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜…

å¦‚æœæŒ‰ç…§ä¸Šè¿°å»ºè®®æ”¹è¿›ï¼ˆå¢åŠ æµ‹è¯•ã€å®Œå–„é”™è¯¯å¤„ç†ã€ä¼˜åŒ–ç¯å¢ƒå˜é‡ï¼‰ï¼Œè¿™å°†æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§åˆ«çš„ uniapp æ¨¡æ¿**ã€‚

---

## ğŸ“š é™„å½•ï¼šå‚è€ƒèµ„æ–™

- [uni-app å®˜æ–¹æ–‡æ¡£](https://uniapp.dcloud.net.cn/)
- [Vite å®˜æ–¹æ–‡æ¡£](https://vitejs.dev/)
- [pnpm å®˜æ–¹æ–‡æ¡£](https://pnpm.io/)
- [Conventional Commits è§„èŒƒ](https://www.conventionalcommits.org/)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š** 2026-01-08  
**åˆ†æäººå‘˜ï¼š** Kiro AI èµ„æ·±æ¶æ„ä¸“å®¶  
**é¡¹ç›®ç‰ˆæœ¬ï¼š** v1.0.4
