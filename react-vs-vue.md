# React vs Vueï¼šæºç æ·±åº¦å¯¹æ¯”

> åŸºäº React 19 å’Œ Vue 3.5 æºç æ·±åº¦åˆ†æï¼Œä»è®¾è®¡å“²å­¦åˆ°å®ç°ç»†èŠ‚ï¼Œå…¨æ–¹ä½å¯¹æ¯”ä¸¤å¤§æ¡†æ¶çš„æ ¸å¿ƒå·®å¼‚ã€‚ä¸€æ–‡ææ‡‚ä¸ºä»€ä¹ˆ React é€‰æ‹©ä¸å¯å˜ï¼ŒVue é€‰æ‹©å“åº”å¼ã€‚

## ä¸€ã€è®¾è®¡å“²å­¦ï¼šä¸¤ç§æ€ç»´æ–¹å¼

### 1.1 æ ¸å¿ƒå…¬å¼

```
React:  UI = f(state)           â†’ çŠ¶æ€çš„å‡½æ•°
Vue:    UI = render(reactive(state))  â†’ å“åº”å¼æ¸²æŸ“
```

### 1.2 ä¸€å›¾çœ‹æ‡‚å·®å¼‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     React çš„ä¸–ç•Œè§‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   "æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€å¼ æ–°ç…§ç‰‡"                                        â”‚
â”‚                                                                  â”‚
â”‚   state = { count: 0 }                                          â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼  setState({ count: 1 })                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚  é‡æ–°æ‰§è¡Œ    â”‚  â† æ•´ä¸ªç»„ä»¶å‡½æ•°é‡æ–°è¿è¡Œ                        â”‚
â”‚   â”‚  ç»„ä»¶å‡½æ•°    â”‚  â† åˆ›å»ºæ–°çš„ JSX                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â† Diff æ‰¾å‡ºå˜åŒ–                              â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   æ›´æ–° DOM                                                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Vue çš„ä¸–ç•Œè§‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   "æˆ‘çŸ¥é“è°åœ¨ç”¨è¿™ä¸ªæ•°æ®"                                          â”‚
â”‚                                                                  â”‚
â”‚   state = reactive({ count: 0 })                                â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼  state.count = 1                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚  Proxy æ‹¦æˆª â”‚  â† çŸ¥é“ count å˜äº†                            â”‚
â”‚   â”‚  trigger()  â”‚  â† çŸ¥é“è°ä¾èµ– count                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â† åªæ›´æ–°ç›¸å…³éƒ¨åˆ†                             â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   ç²¾å‡†æ›´æ–° DOM                                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ ¸å¿ƒå·®å¼‚è¡¨

| ç»´åº¦ | React | Vue |
|-----|-------|-----|
| æ•°æ®ç†å¿µ | ä¸å¯å˜ï¼ˆImmutableï¼‰ | å¯å˜ï¼ˆMutableï¼‰ |
| æ›´æ–°è§¦å‘ | æ˜¾å¼è°ƒç”¨ setState | è‡ªåŠ¨è¿½è¸ªä¾èµ– |
| æ›´æ–°ç²’åº¦ | ç»„ä»¶çº§åˆ« | å±æ€§çº§åˆ« |
| æ¨¡æ¿æ–¹æ¡ˆ | JSXï¼ˆJS ä¸­å†™ HTMLï¼‰ | Templateï¼ˆHTML ä¸­å†™ JSï¼‰ |
| ä¼˜åŒ–æ–¹å¼ | æ‰‹åŠ¨ï¼ˆuseMemo/useCallbackï¼‰ | è‡ªåŠ¨ï¼ˆç¼–è¯‘æ—¶ä¼˜åŒ–ï¼‰ |
| å¿ƒæ™ºæ¨¡å‹ | å‡½æ•°å¼æ€ç»´ | å“åº”å¼æ€ç»´ |

## äºŒã€æ¶æ„å¯¹æ¯”ï¼šä¸‰å¤§æ¨¡å— vs ä¸‰å¤§ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        React æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  Scheduler  â”‚  â”‚ Reconciler  â”‚  â”‚  Renderer   â”‚             â”‚
â”‚   â”‚   è°ƒåº¦å™¨     â”‚  â”‚   åè°ƒå™¨     â”‚  â”‚   æ¸²æŸ“å™¨    â”‚             â”‚
â”‚   â”‚             â”‚  â”‚             â”‚  â”‚             â”‚             â”‚
â”‚   â”‚ â€¢ ä¼˜å…ˆçº§    â”‚  â”‚ â€¢ Fiberæ ‘   â”‚  â”‚ â€¢ ReactDOM  â”‚             â”‚
â”‚   â”‚ â€¢ æ—¶é—´åˆ‡ç‰‡  â”‚  â”‚ â€¢ Diffç®—æ³•  â”‚  â”‚ â€¢ Native    â”‚             â”‚
â”‚   â”‚ â€¢ æœ€å°å †    â”‚  â”‚ â€¢ Hooks     â”‚  â”‚ â€¢ Three.js  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                â”‚                â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â–¼                                       â”‚
â”‚              å¯ä¸­æ–­æ¸²æŸ“ + ä¼˜å…ˆçº§æŠ¢å                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Vue æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  Compiler   â”‚  â”‚  Runtime    â”‚  â”‚ Reactivity  â”‚             â”‚
â”‚   â”‚   ç¼–è¯‘å™¨     â”‚  â”‚   è¿è¡Œæ—¶     â”‚  â”‚   å“åº”å¼    â”‚             â”‚
â”‚   â”‚             â”‚  â”‚             â”‚  â”‚             â”‚             â”‚
â”‚   â”‚ â€¢ Parse     â”‚  â”‚ â€¢ Renderer  â”‚  â”‚ â€¢ Proxy     â”‚             â”‚
â”‚   â”‚ â€¢ Transform â”‚  â”‚ â€¢ Scheduler â”‚  â”‚ â€¢ Dep/Effectâ”‚             â”‚
â”‚   â”‚ â€¢ Codegen   â”‚  â”‚ â€¢ Component â”‚  â”‚ â€¢ Computed  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                â”‚                â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â–¼                                       â”‚
â”‚              ç¼–è¯‘æ—¶ä¼˜åŒ– + ç²¾å‡†æ›´æ–°                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸‰ã€å“åº”å¼åŸç†ï¼šä¸å¯å˜ vs Proxy

### 3.1 Reactï¼šä¸å¯å˜æ•°æ® + è°ƒåº¦æ›´æ–°

```javascript
// React çŠ¶æ€æ›´æ–°çš„å®Œæ•´æµç¨‹
const [count, setCount] = useState(0);

// ä½ å†™çš„ä»£ç 
setCount(1);

// React å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
function dispatchSetState(fiber, queue, action) {
  // 1. åˆ›å»ºæ›´æ–°å¯¹è±¡
  const update = { action, next: null };
  
  // 2. ğŸ”¥ Eager State ä¼˜åŒ–ï¼šæå‰è®¡ç®—
  const currentState = queue.lastRenderedState;
  const eagerState = typeof action === 'function' 
    ? action(currentState) 
    : action;
  
  // 3. ğŸ”¥ ç›¸åŒå€¼ç›´æ¥è·³è¿‡ï¼
  if (Object.is(eagerState, currentState)) {
    return;  // Bailout! ä¸è§¦å‘æ›´æ–°
  }
  
  // 4. å…¥é˜Ÿæ›´æ–°
  enqueueConcurrentHookUpdate(fiber, queue, update);
  
  // 5. è°ƒåº¦æ›´æ–°
  scheduleUpdateOnFiber(fiber);
}
```

### 3.2 Vueï¼šProxy + ä¾èµ–è¿½è¸ª

```javascript
// Vue å“åº”å¼çš„å®Œæ•´æµç¨‹
const state = reactive({ count: 0 });

// ä½ å†™çš„ä»£ç 
state.count = 1;

// Vue å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
const mutableHandlers = {
  get(target, key) {
    // 1. ğŸ”¥ ä¾èµ–æ”¶é›†
    track(target, key);  // è®°å½•"è°åœ¨è¯»è¿™ä¸ªå±æ€§"
    return Reflect.get(target, key);
  },
  
  set(target, key, value) {
    const oldValue = target[key];
    const result = Reflect.set(target, key, value);
    
    // 2. ğŸ”¥ è§¦å‘æ›´æ–°
    if (hasChanged(value, oldValue)) {
      trigger(target, key);  // é€šçŸ¥"æ‰€æœ‰ä¾èµ–è¿™ä¸ªå±æ€§çš„äºº"
    }
    return result;
  }
};
```

### 3.3 ä¾èµ–æ”¶é›†å¯¹æ¯”å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Reactï¼šæ— ä¾èµ–è¿½è¸ª                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   function Component() {                                        â”‚
â”‚     const [a, setA] = useState(0);                              â”‚
â”‚     const [b, setB] = useState(0);                              â”‚
â”‚                                                                  â”‚
â”‚     return <div>{a} + {b}</div>;                                â”‚
â”‚   }                                                              â”‚
â”‚                                                                  â”‚
â”‚   setA(1);  â†’ æ•´ä¸ªç»„ä»¶é‡æ–°æ‰§è¡Œ â†’ é‡æ–°è®¡ç®— a + b                  â”‚
â”‚   setB(1);  â†’ æ•´ä¸ªç»„ä»¶é‡æ–°æ‰§è¡Œ â†’ é‡æ–°è®¡ç®— a + b                  â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ React ä¸çŸ¥é“ div åªä¾èµ– a å’Œ bï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½å…¨é‡æ‰§è¡Œ          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vueï¼šç²¾å‡†ä¾èµ–è¿½è¸ª                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   const a = ref(0);                                             â”‚
â”‚   const b = ref(0);                                             â”‚
â”‚                                                                  â”‚
â”‚   // æ¸²æŸ“æ—¶è‡ªåŠ¨æ”¶é›†ä¾èµ–                                          â”‚
â”‚   effect(() => {                                                â”‚
â”‚     render(a.value + b.value);                                  â”‚
â”‚   });                                                            â”‚
â”‚   // Vue çŸ¥é“ï¼šè¿™ä¸ª effect ä¾èµ– a å’Œ b                           â”‚
â”‚                                                                  â”‚
â”‚   a.value = 1;  â†’ åªè§¦å‘ä¾èµ– a çš„ effect                        â”‚
â”‚   b.value = 1;  â†’ åªè§¦å‘ä¾èµ– b çš„ effect                        â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ Vue ç²¾ç¡®çŸ¥é“è°ä¾èµ–è°ï¼Œåªæ›´æ–°å¿…è¦çš„éƒ¨åˆ†                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 å“åº”å¼å¯¹æ¯”è¡¨

| ç‰¹æ€§ | React | Vue |
|-----|-------|-----|
| å®ç°æ–¹å¼ | ä¸å¯å˜æ•°æ® + setState | Proxy + ä¾èµ–è¿½è¸ª |
| æ›´æ–°ç²’åº¦ | ç»„ä»¶çº§åˆ« | å±æ€§çº§åˆ« |
| æ·±å±‚å“åº” | éœ€è¦å±•å¼€/immer | è‡ªåŠ¨æ·±å±‚å“åº” |
| æ•°ç»„æ›´æ–° | éœ€è¦æ–°æ•°ç»„ | ç›´æ¥ push/splice |
| æ€§èƒ½ä¼˜åŒ– | æ‰‹åŠ¨ useMemo/useCallback | è‡ªåŠ¨ï¼Œcomputed ç¼“å­˜ |
| å¿ƒæ™ºè´Ÿæ‹… | éœ€è¦ç†è§£é—­åŒ…ã€ä¾èµ–æ•°ç»„ | éœ€è¦ç†è§£ .value |

## å››ã€Hooks vs Composition APIï¼šæ®Šé€”åŒå½’

### 4.1 ä»£ç å¯¹æ¯”

```javascript
// ==================== React Hooks ====================
function useCounter() {
  const [count, setCount] = useState(0);
  const double = useMemo(() => count * 2, [count]);  // æ‰‹åŠ¨å£°æ˜ä¾èµ–
  
  useEffect(() => {
    document.title = `Count: ${count}`;
    return () => console.log('cleanup');  // æ¸…ç†å‡½æ•°
  }, [count]);  // æ‰‹åŠ¨å£°æ˜ä¾èµ–
  
  return { count, double, increment: () => setCount(c => c + 1) };
}

// ==================== Vue Composition API ====================
function useCounter() {
  const count = ref(0);
  const double = computed(() => count.value * 2);  // è‡ªåŠ¨è¿½è¸ªä¾èµ–
  
  watchEffect((onCleanup) => {
    document.title = `Count: ${count.value}`;
    onCleanup(() => console.log('cleanup'));
  });  // è‡ªåŠ¨è¿½è¸ªä¾èµ–
  
  return { count, double, increment: () => count.value++ };
}
```

### 4.2 useEffect vs watch/watchEffect

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    useEffect æ‰§è¡Œæ—¶æœº                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Render é˜¶æ®µ â”€â”€â–º Commit é˜¶æ®µ â”€â”€â–º æµè§ˆå™¨ç»˜åˆ¶ â”€â”€â–º useEffect      â”‚
â”‚       â”‚              â”‚              â”‚              â”‚             â”‚
â”‚       â”‚              â”‚              â”‚              â–¼             â”‚
â”‚   æ‰§è¡Œç»„ä»¶å‡½æ•°    DOM æ“ä½œ      å±å¹•æ›´æ–°      å¼‚æ­¥æ‰§è¡Œå›è°ƒ        â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ useEffect åœ¨æµè§ˆå™¨ç»˜åˆ¶åå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡æ¸²æŸ“                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    watchEffect æ‰§è¡Œæ—¶æœº                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   æ•°æ®å˜åŒ– â”€â”€â–º queueJob â”€â”€â–º flushJobs â”€â”€â–º watchEffect â”€â”€â–º DOM   â”‚
â”‚       â”‚           â”‚            â”‚              â”‚            â”‚     â”‚
â”‚       â”‚           â”‚            â”‚              â–¼            â”‚     â”‚
â”‚   trigger()   å…¥é˜Ÿæ›´æ–°    å¾®ä»»åŠ¡æ‰§è¡Œ    åŒæ­¥æ‰§è¡Œå›è°ƒ    patch    â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ watchEffect é»˜è®¤åœ¨ DOM æ›´æ–°å‰åŒæ­¥æ‰§è¡Œ                       â”‚
â”‚   ğŸ’¡ å¯é€šè¿‡ flush: 'post' æ”¹ä¸º DOM æ›´æ–°åæ‰§è¡Œ                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 å‰¯ä½œç”¨å¯¹æ¯”è¡¨

| ç‰¹æ€§ | useEffect | watchEffect | watch |
|-----|-----------|-------------|-------|
| ä¾èµ–è¿½è¸ª | æ‰‹åŠ¨å£°æ˜æ•°ç»„ | è‡ªåŠ¨è¿½è¸ª | æ˜¾å¼æŒ‡å®š |
| æ‰§è¡Œæ—¶æœº | å¼‚æ­¥ï¼ˆç»˜åˆ¶åï¼‰ | åŒæ­¥ï¼ˆæ›´æ–°å‰ï¼‰ | å¯é…ç½® |
| è·å–æ—§å€¼ | éœ€è¦ useRef | âŒ | âœ… å›è°ƒå‚æ•° |
| æ¸…ç†å‡½æ•° | return è¿”å› | onCleanup å‚æ•° | onCleanup |
| ç«‹å³æ‰§è¡Œ | é¦–æ¬¡æ¸²æŸ“å | ç«‹å³æ‰§è¡Œ | immediate é€‰é¡¹ |
| é—­åŒ…é™·é˜± | âš ï¸ å­˜åœ¨ | âœ… ä¸å­˜åœ¨ | âœ… ä¸å­˜åœ¨ |

### 4.4 é—­åŒ…é™·é˜±è¯¦è§£

```javascript
// ==================== React é—­åŒ…é™·é˜± ====================
function Counter() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    const timer = setInterval(() => {
      console.log(count);  // ğŸ˜± æ°¸è¿œæ˜¯ 0ï¼
    }, 1000);
    return () => clearInterval(timer);
  }, []);  // ç©ºä¾èµ–ï¼Œåªåœ¨ mount æ—¶åˆ›å»º
  
  // è§£å†³æ–¹æ¡ˆ1ï¼šæ·»åŠ ä¾èµ–
  // }, [count]);
  
  // è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ ref
  // const countRef = useRef(count);
  // countRef.current = count;
}

// ==================== Vue æ— é—­åŒ…é™·é˜± ====================
const count = ref(0);

watchEffect(() => {
  setInterval(() => {
    console.log(count.value);  // âœ… å§‹ç»ˆæ˜¯æœ€æ–°å€¼ï¼
  }, 1000);
});
// Vue çš„ ref æ˜¯å“åº”å¼å¯¹è±¡ï¼Œè¯»å– .value æ—¶æ€»æ˜¯æœ€æ–°å€¼
```

## äº”ã€è™šæ‹Ÿ DOMï¼šFiber é“¾è¡¨ vs VNode æ•°ç»„

### 5.1 æ•°æ®ç»“æ„å¯¹æ¯”

```javascript
// ==================== React Fiber ====================
interface FiberNode {
  tag: number;              // ç»„ä»¶ç±»å‹
  type: any;                // ç»„ä»¶å‡½æ•°/ç±»/æ ‡ç­¾å
  key: string | null;
  
  // ğŸ”¥ é“¾è¡¨ç»“æ„ï¼ˆä¾¿äºä¸­æ–­æ¢å¤ï¼‰
  return: Fiber | null;     // çˆ¶èŠ‚ç‚¹
  child: Fiber | null;      // ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
  sibling: Fiber | null;    // å…„å¼ŸèŠ‚ç‚¹
  
  // çŠ¶æ€
  memoizedState: any;       // Hooks é“¾è¡¨
  memoizedProps: any;
  
  // å‰¯ä½œç”¨
  flags: number;            // æ ‡è®°ï¼ˆPlacement/Update/Deletionï¼‰
  subtreeFlags: number;     // ğŸ”¥ å­æ ‘æ ‡è®°ï¼ˆå†’æ³¡ä¼˜åŒ–ï¼‰
  
  // ğŸ”¥ åŒç¼“å†²
  alternate: Fiber | null;  // å¦ä¸€æ£µæ ‘çš„å¯¹åº”èŠ‚ç‚¹
}

// ==================== Vue VNode ====================
interface VNode {
  type: VNodeTypes;         // èŠ‚ç‚¹ç±»å‹
  props: VNodeProps | null;
  key: string | number | null;
  
  // ğŸ”¥ æ•°ç»„ç»“æ„
  children: VNodeChildren;
  
  // DOM ç›¸å…³
  el: Element | null;       // çœŸå® DOM
  
  // ğŸ”¥ ç¼–è¯‘ä¼˜åŒ–æ ‡è®°
  shapeFlag: number;        // èŠ‚ç‚¹å½¢çŠ¶
  patchFlag: number;        // patch ä¼˜åŒ–æ ‡è®°
  dynamicProps: string[];   // åŠ¨æ€å±æ€§åˆ—è¡¨
  dynamicChildren: VNode[]; // ğŸ”¥ Block Treeï¼šåªè¿½è¸ªåŠ¨æ€èŠ‚ç‚¹
}
```

### 5.2 ç»“æ„å¯è§†åŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Fiber æ ‘ï¼ˆé“¾è¡¨ï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                        App                                       â”‚
â”‚                         â”‚                                        â”‚
â”‚                       child                                      â”‚
â”‚                         â–¼                                        â”‚
â”‚                       Header â”€â”€siblingâ”€â”€â–º Main â”€â”€siblingâ”€â”€â–º Footer
â”‚                         â”‚                  â”‚                     â”‚
â”‚                       child              child                   â”‚
â”‚                         â–¼                  â–¼                     â”‚
â”‚                       Logo              Content                  â”‚
â”‚                                                                  â”‚
â”‚   éå†é¡ºåºï¼šApp â†’ Header â†’ Logo â†’ Main â†’ Content â†’ Footer       â”‚
â”‚   ğŸ’¡ é“¾è¡¨ç»“æ„å¯ä»¥éšæ—¶ä¸­æ–­ï¼Œè®°ä½ä½ç½®åç»§ç»­                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vue VNode æ ‘ï¼ˆæ•°ç»„ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                        App                                       â”‚
â”‚                         â”‚                                        â”‚
â”‚                     children                                     â”‚
â”‚                         â–¼                                        â”‚
â”‚              [Header, Main, Footer]                              â”‚
â”‚                  â”‚       â”‚      â”‚                                â”‚
â”‚              children children children                          â”‚
â”‚                  â–¼       â–¼      â–¼                                â”‚
â”‚               [Logo] [Content]  []                               â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ æ•°ç»„ç»“æ„æ›´ç›´è§‚ï¼Œä½†ä¸æ”¯æŒä¸­æ–­                                â”‚
â”‚   ğŸ’¡ é€šè¿‡ dynamicChildren åªè¿½è¸ªåŠ¨æ€èŠ‚ç‚¹                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 è™šæ‹Ÿ DOM å¯¹æ¯”è¡¨

| ç‰¹æ€§ | React Fiber | Vue VNode |
|-----|-------------|-----------|
| æ ‘ç»“æ„ | é“¾è¡¨ï¼ˆchild/sibling/returnï¼‰ | æ•°ç»„ï¼ˆchildrenï¼‰ |
| å¯ä¸­æ–­ | âœ… é“¾è¡¨ä¾¿äºä¸­æ–­æ¢å¤ | âŒ åŒæ­¥æ¸²æŸ“ |
| åŒç¼“å†² | âœ… current/workInProgress | âŒ ç›´æ¥å¤ç”¨ |
| ç¼–è¯‘ä¼˜åŒ– | âŒ çº¯è¿è¡Œæ—¶ | âœ… PatchFlags/Block Tree |
| é™æ€æå‡ | âŒ | âœ… ç¼–è¯‘æ—¶æå‡åˆ°å‡½æ•°å¤– |
| å†…å­˜å ç”¨ | è¾ƒå¤§ï¼ˆåŒæ ‘ + é“¾è¡¨æŒ‡é’ˆï¼‰ | è¾ƒå° |

## å…­ã€Diff ç®—æ³•ï¼šä¸‰è½®éå† vs åŒç«¯ + æœ€é•¿é€’å¢å­åºåˆ—

### 6.1 ç®—æ³•æµç¨‹å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Diffï¼ˆä¸‰è½®éå†ï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   æ—§: [A, B, C, D, E]                                           â”‚
â”‚   æ–°: [A, C, D, B, F]                                           â”‚
â”‚                                                                  â”‚
â”‚   ç¬¬ä¸€è½®ï¼šä»å·¦åˆ°å³ï¼Œå¤„ç†æ›´æ–°                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   A === A âœ“ patch                                               â”‚
â”‚   B !== C âœ— è·³å‡º                                                â”‚
â”‚                                                                  â”‚
â”‚   ç¬¬äºŒè½®ï¼šå¤„ç†æ–°å¢/åˆ é™¤                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   æ—§èŠ‚ç‚¹æ²¡éå†å®Œï¼Œæ–°èŠ‚ç‚¹æ²¡éå†å®Œ â†’ è¿›å…¥ç¬¬ä¸‰è½®                    â”‚
â”‚                                                                  â”‚
â”‚   ç¬¬ä¸‰è½®ï¼šå¤„ç†ç§»åŠ¨ï¼ˆMap + lastPlacedIndexï¼‰                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   å»ºç«‹ Map: { B:1, C:2, D:3, E:4 }                              â”‚
â”‚   éå†æ–°èŠ‚ç‚¹ [C, D, B, F]ï¼š                                      â”‚
â”‚   - C: oldIndex=2, lastPlacedIndex=0 â†’ ä¸ç§»åŠ¨, lastPlacedIndex=2â”‚
â”‚   - D: oldIndex=3 > 2 â†’ ä¸ç§»åŠ¨, lastPlacedIndex=3               â”‚
â”‚   - B: oldIndex=1 < 3 â†’ ğŸ”¥ éœ€è¦ç§»åŠ¨                             â”‚
â”‚   - F: ä¸åœ¨ Map â†’ æ–°å¢                                          â”‚
â”‚   - E: åœ¨ Map ä½†ä¸åœ¨æ–°åˆ—è¡¨ â†’ åˆ é™¤                               â”‚
â”‚                                                                  â”‚
â”‚   ç»“æœï¼šç§»åŠ¨ Bï¼Œæ–°å¢ Fï¼Œåˆ é™¤ E                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vue Diffï¼ˆåŒç«¯ + LISï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   æ—§: [A, B, C, D, E]                                           â”‚
â”‚   æ–°: [A, C, D, B, F]                                           â”‚
â”‚                                                                  â”‚
â”‚   Step 1ï¼šå¤´éƒ¨åŒæ­¥                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   A === A âœ“ patch, i++                                          â”‚
â”‚                                                                  â”‚
â”‚   Step 2ï¼šå°¾éƒ¨åŒæ­¥                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   E !== F âœ— åœæ­¢                                                â”‚
â”‚                                                                  â”‚
â”‚   Step 3ï¼šä¸­é—´ä¹±åºéƒ¨åˆ†                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   æ—§: [B, C, D, E]  æ–°: [C, D, B, F]                            â”‚
â”‚                                                                  â”‚
â”‚   å»ºç«‹ keyToNewIndexMap: { C:0, D:1, B:2, F:3 }                 â”‚
â”‚   newIndexToOldIndexMap: [2, 3, 1, 0]  (Cåœ¨æ—§2, Dåœ¨æ—§3, Båœ¨æ—§1) â”‚
â”‚                                                                  â”‚
â”‚   ğŸ”¥ æœ€é•¿é€’å¢å­åºåˆ—: [2, 3] â†’ ç´¢å¼• [0, 1]                       â”‚
â”‚   - C (ç´¢å¼•0) åœ¨ LIS ä¸­ â†’ ä¸ç§»åŠ¨                                â”‚
â”‚   - D (ç´¢å¼•1) åœ¨ LIS ä¸­ â†’ ä¸ç§»åŠ¨                                â”‚
â”‚   - B (ç´¢å¼•2) ä¸åœ¨ LIS â†’ éœ€è¦ç§»åŠ¨                               â”‚
â”‚   - F (ç´¢å¼•3) oldIndex=0 â†’ æ–°å¢                                 â”‚
â”‚   - E ä¸åœ¨æ–°åˆ—è¡¨ â†’ åˆ é™¤                                         â”‚
â”‚                                                                  â”‚
â”‚   ç»“æœï¼šç§»åŠ¨ Bï¼Œæ–°å¢ Fï¼Œåˆ é™¤ Eï¼ˆä¸ React ç›¸åŒï¼Œä½†ç§»åŠ¨æ›´å°‘ï¼‰      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ç§»åŠ¨æ¬¡æ•°å¯¹æ¯”ç¤ºä¾‹

```
æ—§: [A, B, C, D]
æ–°: [A, D, B, C]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Reactï¼ˆlastPlacedIndexï¼‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   A: oldIndex=0, lastPlacedIndex=0 â†’ ä¸ç§»åŠ¨                     â”‚
â”‚   D: oldIndex=3, lastPlacedIndex=3 â†’ ä¸ç§»åŠ¨                     â”‚
â”‚   B: oldIndex=1 < 3 â†’ ğŸ”¥ ç§»åŠ¨                                   â”‚
â”‚   C: oldIndex=2 < 3 â†’ ğŸ”¥ ç§»åŠ¨                                   â”‚
â”‚                                                                  â”‚
â”‚   ç»“æœï¼šç§»åŠ¨ 2 æ¬¡ï¼ˆB å’Œ Cï¼‰                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vueï¼ˆæœ€é•¿é€’å¢å­åºåˆ—ï¼‰                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   newIndexToOldIndexMap: [1, 4, 2, 3]  (A=1, D=4, B=2, C=3)     â”‚
â”‚   æœ€é•¿é€’å¢å­åºåˆ—: [1, 2, 3] â†’ ç´¢å¼• [0, 2, 3]                    â”‚
â”‚                                                                  â”‚
â”‚   A (ç´¢å¼•0) åœ¨ LIS â†’ ä¸ç§»åŠ¨                                     â”‚
â”‚   D (ç´¢å¼•1) ä¸åœ¨ LIS â†’ ğŸ”¥ ç§»åŠ¨                                  â”‚
â”‚   B (ç´¢å¼•2) åœ¨ LIS â†’ ä¸ç§»åŠ¨                                     â”‚
â”‚   C (ç´¢å¼•3) åœ¨ LIS â†’ ä¸ç§»åŠ¨                                     â”‚
â”‚                                                                  â”‚
â”‚   ç»“æœï¼šç§»åŠ¨ 1 æ¬¡ï¼ˆåªç§»åŠ¨ Dï¼‰                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 Diff ç®—æ³•å¯¹æ¯”è¡¨

| ç‰¹æ€§ | React | Vue |
|-----|-------|-----|
| ç®—æ³• | ä¸‰è½®éå† + Map | åŒç«¯å¯¹æ¯” + æœ€é•¿é€’å¢å­åºåˆ— |
| ç§»åŠ¨åˆ¤æ–­ | lastPlacedIndex | æœ€é•¿é€’å¢å­åºåˆ— |
| æ—¶é—´å¤æ‚åº¦ | O(n) | O(n log n)ï¼ˆLIS ç”¨äºŒåˆ†ï¼‰ |
| ç§»åŠ¨æ¬¡æ•° | å¯èƒ½è¾ƒå¤š | ç†è®ºæœ€å°‘ |
| å®ç°å¤æ‚åº¦ | ç®€å• | è¾ƒå¤æ‚ |

## ä¸ƒã€è°ƒåº¦æœºåˆ¶ï¼šæ—¶é—´åˆ‡ç‰‡ vs å¾®ä»»åŠ¡æ‰¹é‡

### 7.1 è°ƒåº¦ç­–ç•¥å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Schedulerï¼ˆæ—¶é—´åˆ‡ç‰‡ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   ä¼˜å…ˆçº§ï¼ˆ5 ä¸ªçº§åˆ«ï¼‰ï¼š                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ ImmediatePriority   â”‚ -1ms    â”‚ ç«‹å³æ‰§è¡Œï¼ˆåŒæ­¥ï¼‰        â”‚    â”‚
â”‚   â”‚ UserBlockingPriorityâ”‚ 250ms   â”‚ ç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ã€è¾“å…¥ï¼‰  â”‚    â”‚
â”‚   â”‚ NormalPriority      â”‚ 5000ms  â”‚ æ™®é€šæ›´æ–°ï¼ˆsetStateï¼‰    â”‚    â”‚
â”‚   â”‚ LowPriority         â”‚ 10000ms â”‚ ä½ä¼˜å…ˆçº§               â”‚    â”‚
â”‚   â”‚ IdlePriority        â”‚ âˆ       â”‚ ç©ºé—²æ‰§è¡Œ               â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚   æ—¶é—´åˆ‡ç‰‡ï¼ˆ5ms ä¸€ç‰‡ï¼‰ï¼š                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚ 5ms â”‚â†’â”‚ 5ms â”‚â†’â”‚ 5ms â”‚â†’â”‚ 5ms â”‚â†’ ...                         â”‚
â”‚   â”‚work â”‚ â”‚work â”‚ â”‚work â”‚ â”‚work â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚       â†“       â†“       â†“       â†“                                 â”‚
â”‚     yield   yield   yield   yield  â† è®©å‡ºä¸»çº¿ç¨‹                 â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ é«˜ä¼˜å…ˆçº§å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§                                    â”‚
â”‚   ğŸ’¡ ç”¨æˆ·äº¤äº’ä¸ä¼šè¢«é•¿ä»»åŠ¡é˜»å¡                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vue Schedulerï¼ˆå¾®ä»»åŠ¡æ‰¹é‡ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   åŒæ­¥ä»£ç æ‰§è¡Œï¼š                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ state.a = 1  â†’ trigger â†’ queueJob(update)              â”‚    â”‚
â”‚   â”‚ state.b = 2  â†’ trigger â†’ å·²å…¥é˜Ÿï¼Œè·³è¿‡                   â”‚    â”‚
â”‚   â”‚ state.c = 3  â†’ trigger â†’ å·²å…¥é˜Ÿï¼Œè·³è¿‡                   â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚   å¾®ä»»åŠ¡æ‰§è¡Œï¼šPromise.resolve().then(flushJobs)                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ 1. æŒ‰ç»„ä»¶ id æ’åºï¼ˆçˆ¶ç»„ä»¶å…ˆäºå­ç»„ä»¶ï¼‰                   â”‚    â”‚
â”‚   â”‚ 2. ä¾æ¬¡æ‰§è¡Œ update ä»»åŠ¡                                 â”‚    â”‚
â”‚   â”‚ 3. æ‰§è¡Œ postFlushCbsï¼ˆmounted/updatedï¼‰                 â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ å¤šæ¬¡ä¿®æ”¹åªè§¦å‘ä¸€æ¬¡æ›´æ–°                                      â”‚
â”‚   ğŸ’¡ ç®€å•é«˜æ•ˆï¼Œä½†ä¸æ”¯æŒä¸­æ–­                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ ¸å¿ƒä»£ç å¯¹æ¯”

```javascript
// ==================== React Scheduler ====================
function workLoop() {
  while (task !== null && !shouldYield()) {  // ğŸ”¥ 5ms æ£€æŸ¥ä¸€æ¬¡
    task = performTask(task);
  }
  if (task !== null) {
    // è¿˜æœ‰ä»»åŠ¡ï¼Œç»§ç»­è°ƒåº¦
    scheduleCallback(task);
  }
}

function shouldYield() {
  return getCurrentTime() - startTime > 5;  // 5ms æ—¶é—´ç‰‡
}

// ä½¿ç”¨ MessageChannel é¿å… setTimeout çš„ 4ms å»¶è¿Ÿ
const channel = new MessageChannel();
channel.port1.onmessage = performWorkUntilDeadline;

// ==================== Vue Scheduler ====================
function queueJob(job) {
  if (!queue.includes(job)) {
    // ğŸ”¥ äºŒåˆ†æŸ¥æ‰¾æ’å…¥ä½ç½®ï¼Œä¿æŒæŒ‰ id æ’åº
    queue.splice(findInsertionIndex(job.id), 0, job);
    queueFlush();
  }
}

function queueFlush() {
  if (!currentFlushPromise) {
    // ğŸ”¥ ä½¿ç”¨å¾®ä»»åŠ¡
    currentFlushPromise = Promise.resolve().then(flushJobs);
  }
}

function flushJobs() {
  // æŒ‰ id æ’åºæ‰§è¡Œï¼ˆçˆ¶ç»„ä»¶å…ˆäºå­ç»„ä»¶ï¼‰
  for (const job of queue) {
    job();
  }
  queue.length = 0;
  flushPostFlushCbs();  // æ‰§è¡Œ mounted/updated
}
```

### 7.3 è°ƒåº¦å¯¹æ¯”è¡¨

| ç‰¹æ€§ | React | Vue |
|-----|-------|-----|
| è°ƒåº¦ç­–ç•¥ | ä¼˜å…ˆçº§ + æ—¶é—´åˆ‡ç‰‡ | å¾®ä»»åŠ¡æ‰¹é‡æ›´æ–° |
| å¯ä¸­æ–­ | âœ… Concurrent Mode | âŒ åŒæ­¥æ¸²æŸ“ |
| ä¼˜å…ˆçº§ | 5 ä¸ªçº§åˆ« | æ— ï¼ˆæŒ‰ç»„ä»¶ id æ’åºï¼‰ |
| æ—¶é—´åˆ‡ç‰‡ | âœ… 5ms ä¸€ç‰‡ | âŒ |
| å®ç°æ–¹å¼ | MessageChannel | Promise.resolve() |
| ä»»åŠ¡é˜Ÿåˆ— | æœ€å°å † | æ•°ç»„ï¼ˆäºŒåˆ†æ’å…¥ï¼‰ |
| å¤æ‚åº¦ | é«˜ | ä½ |

## å…«ã€ç¼–è¯‘ä¼˜åŒ–ï¼šè¿è¡Œæ—¶ vs ç¼–è¯‘æ—¶

### 8.1 ç¼–è¯‘å¯¹æ¯”

```javascript
// ==================== Reactï¼šçº¯è¿è¡Œæ—¶ ====================
// ä½ å†™çš„ JSX
<div className="container">
  <span>{msg}</span>
  <p>static text</p>
</div>

// ç¼–è¯‘åï¼ˆåªæ˜¯è¯­æ³•è½¬æ¢ï¼‰
React.createElement("div", { className: "container" },
  React.createElement("span", null, msg),
  React.createElement("p", null, "static text")
);

// ğŸ’¡ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡ï¼Œéœ€è¦å®Œæ•´ Diff
// ğŸ’¡ é™æ€å†…å®¹ä¹Ÿå‚ä¸ Diff

// ==================== Vueï¼šç¼–è¯‘æ—¶ä¼˜åŒ– ====================
// ä½ å†™çš„ Template
<template>
  <div class="container">
    <span>{{ msg }}</span>
    <p>static text</p>
  </div>
</template>

// ç¼–è¯‘åï¼ˆæ·±åº¦ä¼˜åŒ–ï¼‰
// ğŸ”¥ é™æ€æå‡ï¼šé™æ€èŠ‚ç‚¹åªåˆ›å»ºä¸€æ¬¡
const _hoisted_1 = /*#__PURE__*/_createElementVNode("p", null, "static text", -1)

function render(_ctx) {
  return (_openBlock(), _createElementBlock("div", { class: "container" }, [
    _createElementVNode("span", null, _toDisplayString(_ctx.msg), 1 /* TEXT */),
    _hoisted_1  // ğŸ”¥ å¤ç”¨é™æ€èŠ‚ç‚¹
  ]))
}

// ğŸ’¡ PatchFlag = 1 è¡¨ç¤ºåªæœ‰æ–‡æœ¬æ˜¯åŠ¨æ€çš„
// ğŸ’¡ é™æ€èŠ‚ç‚¹è¢«æå‡ï¼Œä¸å‚ä¸ Diff
```

### 8.2 Block Tree ä¼˜åŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vue Block Tree                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   ä¼ ç»Ÿ Diffï¼šéå†æ•´æ£µæ ‘                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚              div                         â”‚                   â”‚
â”‚   â”‚            /  |  \                       â”‚                   â”‚
â”‚   â”‚         span  p   ul                     â”‚  â† éœ€è¦éå†æ‰€æœ‰   â”‚
â”‚   â”‚          |       / | \                   â”‚                   â”‚
â”‚   â”‚        {msg}   li li li                  â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â”‚   Block Treeï¼šåªè¿½è¸ªåŠ¨æ€èŠ‚ç‚¹                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚              div (Block)                 â”‚                   â”‚
â”‚   â”‚                 â”‚                        â”‚                   â”‚
â”‚   â”‚         dynamicChildren: [               â”‚  â† åªéå†åŠ¨æ€    â”‚
â”‚   â”‚           span (TEXT),                   â”‚                   â”‚
â”‚   â”‚         ]                                â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â”‚   ğŸ’¡ é™æ€èŠ‚ç‚¹å®Œå…¨è·³è¿‡ï¼Œåª patch åŠ¨æ€èŠ‚ç‚¹                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 PatchFlags è¯¦è§£

```javascript
// Vue ç¼–è¯‘æ—¶æ ‡è®°åŠ¨æ€å†…å®¹ç±»å‹
enum PatchFlags {
  TEXT = 1,           // åŠ¨æ€æ–‡æœ¬ï¼š{{ msg }}
  CLASS = 2,          // åŠ¨æ€ classï¼š:class="cls"
  STYLE = 4,          // åŠ¨æ€ styleï¼š:style="stl"
  PROPS = 8,          // åŠ¨æ€ propsï¼š:id="id"
  FULL_PROPS = 16,    // æœ‰åŠ¨æ€ key
  NEED_HYDRATION = 32,
  STABLE_FRAGMENT = 64,
  KEYED_FRAGMENT = 128,
  UNKEYED_FRAGMENT = 256,
  NEED_PATCH = 512,
  DYNAMIC_SLOTS = 1024,
  HOISTED = -1,       // ğŸ”¥ é™æ€æå‡
  BAIL = -2           // é€€å‡ºä¼˜åŒ–æ¨¡å¼
}

// patch æ—¶æ ¹æ® flag ç²¾å‡†æ›´æ–°
if (patchFlag & PatchFlags.TEXT) {
  // åªæ›´æ–°æ–‡æœ¬
  hostSetElementText(el, newChildren);
}
if (patchFlag & PatchFlags.CLASS) {
  // åªæ›´æ–° class
  hostPatchProp(el, 'class', null, newProps.class);
}
```

### 8.4 ç¼–è¯‘ä¼˜åŒ–å¯¹æ¯”è¡¨

| ä¼˜åŒ– | React | Vue |
|-----|-------|-----|
| é™æ€æå‡ | âŒ | âœ… é™æ€èŠ‚ç‚¹åªåˆ›å»ºä¸€æ¬¡ |
| PatchFlags | âŒ | âœ… æ ‡è®°åŠ¨æ€å†…å®¹ç±»å‹ |
| Block Tree | âŒ | âœ… åªè¿½è¸ªåŠ¨æ€èŠ‚ç‚¹ |
| äº‹ä»¶ç¼“å­˜ | âŒ éœ€ useCallback | âœ… è‡ªåŠ¨ç¼“å­˜ |
| é¢„å­—ç¬¦ä¸²åŒ– | âŒ | âœ… è¿ç»­é™æ€èŠ‚ç‚¹åˆå¹¶ä¸ºå­—ç¬¦ä¸² |
| ç¼–è¯‘æ—¶ä¼˜åŒ– | æ—  | æ˜¾è‘—å‡å°‘è¿è¡Œæ—¶å¼€é”€ |

## ä¹ã€ç»„ä»¶æ›´æ–°æµç¨‹ï¼šå®Œæ•´å¯¹æ¯”

### 9.1 React æ›´æ–°æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React å®Œæ•´æ›´æ–°æµç¨‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   setState(newValue)                                            â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   dispatchSetState()                                            â”‚
â”‚        â”‚                                                         â”‚
â”‚        â”œâ”€â”€ ğŸ”¥ Eager Stateï¼šæå‰è®¡ç®—ï¼Œç›¸åŒå€¼è·³è¿‡                  â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   scheduleUpdateOnFiber() â† æ ‡è®° Fiber éœ€è¦æ›´æ–°                 â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   ensureRootIsScheduled() â† ç¡®ä¿æ ¹èŠ‚ç‚¹è¢«è°ƒåº¦                    â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   Scheduler.scheduleCallback(priority, callback)                â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Render é˜¶æ®µï¼ˆå¯ä¸­æ–­ï¼‰                        â”‚   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â”‚   workLoopConcurrent()                                   â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â–¼                                                 â”‚   â”‚
â”‚   â”‚   performUnitOfWork(fiber)                               â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â”œâ”€â”€ beginWork() â† é€’ï¼šæ‰§è¡Œç»„ä»¶å‡½æ•°ï¼Œå¤„ç† Hooks    â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â””â”€â”€ completeWork() â† å½’ï¼šåˆ›å»º DOMï¼Œæ”¶é›†å‰¯ä½œç”¨     â”‚   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â”‚   ğŸ’¡ æ¯å¤„ç†ä¸€ä¸ª Fiber æ£€æŸ¥ shouldYield()                 â”‚   â”‚
â”‚   â”‚   ğŸ’¡ è¶…æ—¶åˆ™è®©å‡ºä¸»çº¿ç¨‹ï¼Œä¸‹æ¬¡ç»§ç»­                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              Commit é˜¶æ®µï¼ˆä¸å¯ä¸­æ–­ï¼‰                      â”‚   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â”‚   Before Mutation â† getSnapshotBeforeUpdate              â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â–¼                                                 â”‚   â”‚
â”‚   â”‚   Mutation â† DOM æ“ä½œï¼ˆå¢åˆ æ”¹ï¼‰                          â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â–¼                                                 â”‚   â”‚
â”‚   â”‚   ğŸ”¥ root.current = finishedWork â† åˆ‡æ¢ Fiber æ ‘        â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â–¼                                                 â”‚   â”‚
â”‚   â”‚   Layout â† useLayoutEffectã€componentDidMount            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   flushPassiveEffects() â† useEffectï¼ˆå¼‚æ­¥ï¼Œæµè§ˆå™¨ç»˜åˆ¶åï¼‰       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Vue æ›´æ–°æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vue å®Œæ•´æ›´æ–°æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   state.count = newValue                                        â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   Proxy set æ‹¦æˆª                                                â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   trigger(target, key) â† è§¦å‘ä¾èµ–                               â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   éå† Dep.subsï¼Œè°ƒç”¨ effect.scheduler()                        â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   queueJob(componentUpdate) â† å…¥é˜Ÿæ›´æ–°ä»»åŠ¡                      â”‚
â”‚        â”‚                                                         â”‚
â”‚        â”œâ”€â”€ ğŸ”¥ å»é‡ï¼šç›¸åŒä»»åŠ¡ä¸é‡å¤å…¥é˜Ÿ                           â”‚
â”‚        â”œâ”€â”€ ğŸ”¥ æ’åºï¼šæŒ‰ç»„ä»¶ id æ’åºï¼ˆçˆ¶å…ˆäºå­ï¼‰                   â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   queueFlush() â† Promise.resolve().then(flushJobs)              â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åŒæ­¥ä»£ç ç»“æŸï¼Œå¾®ä»»åŠ¡å¼€å§‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   flushJobs()                                                   â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              ç»„ä»¶æ›´æ–°                                     â”‚   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â”‚   componentUpdateFn()                                    â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â”œâ”€â”€ onBeforeUpdate hooks                          â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â”œâ”€â”€ render() â† ç”Ÿæˆæ–° VNode                       â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â”œâ”€â”€ patch(prevTree, nextTree) â† Diff + DOM æ›´æ–°   â”‚   â”‚
â”‚   â”‚        â”‚        â”‚                                        â”‚   â”‚
â”‚   â”‚        â”‚        â”œâ”€â”€ ğŸ”¥ Block Treeï¼šåªéå†åŠ¨æ€èŠ‚ç‚¹        â”‚   â”‚
â”‚   â”‚        â”‚        â””â”€â”€ ğŸ”¥ PatchFlagsï¼šç²¾å‡†æ›´æ–°              â”‚   â”‚
â”‚   â”‚        â”‚                                                 â”‚   â”‚
â”‚   â”‚        â””â”€â”€ queuePostFlushCb(onUpdated)                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                         â”‚
â”‚        â–¼                                                         â”‚
â”‚   flushPostFlushCbs() â† onMounted/onUpdated hooks               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 æ›´æ–°æµç¨‹å¯¹æ¯”è¡¨

| é˜¶æ®µ | React | Vue |
|-----|-------|-----|
| è§¦å‘æ›´æ–° | setState â†’ dispatchSetState | Proxy set â†’ trigger |
| è°ƒåº¦æ–¹å¼ | Scheduler + ä¼˜å…ˆçº§ | å¾®ä»»åŠ¡ + å»é‡æ’åº |
| æ¸²æŸ“é˜¶æ®µ | Renderï¼ˆå¯ä¸­æ–­ï¼‰ | åŒæ­¥æ‰§è¡Œ |
| DOM æ“ä½œ | Commitï¼ˆä¸å¯ä¸­æ–­ï¼‰ | patchï¼ˆåŒæ­¥ï¼‰ |
| å‰¯ä½œç”¨æ‰§è¡Œ | useEffectï¼ˆå¼‚æ­¥ï¼‰ | watchEffectï¼ˆå¯é…ç½®ï¼‰ |
| ç”Ÿå‘½å‘¨æœŸ | Layout é˜¶æ®µæ‰§è¡Œ | postFlushCbs æ‰§è¡Œ |

## åã€ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”Ÿå‘½å‘¨æœŸæ˜ å°„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   React Class          React Hooks           Vue 3               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€               â”‚
â”‚   constructor          -                     setup()             â”‚
â”‚   render               return JSX            render()/template   â”‚
â”‚   componentDidMount    useEffect(,[])        onMounted           â”‚
â”‚   componentDidUpdate   useEffect             onUpdated           â”‚
â”‚   componentWillUnmount useEffect return      onBeforeUnmount     â”‚
â”‚   -                    -                     onUnmounted         â”‚
â”‚   -                    useLayoutEffect       onBeforeMount+Mountedâ”‚
â”‚   getDerivedState      -                     watch + computed    â”‚
â”‚   shouldComponentUpdate React.memo           -ï¼ˆè‡ªåŠ¨ä¼˜åŒ–ï¼‰        â”‚
â”‚   getSnapshotBefore    -                     onBeforeUpdate      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ‰§è¡Œæ—¶æœºå¯¹æ¯”                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   React:                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Render â†’ Commit(Layout) â†’ æµè§ˆå™¨ç»˜åˆ¶ â†’ useEffect        â”‚   â”‚
â”‚   â”‚                  â†‘                           â†‘          â”‚   â”‚
â”‚   â”‚          useLayoutEffect              å¼‚æ­¥æ‰§è¡Œ          â”‚   â”‚
â”‚   â”‚          componentDidMount                              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   Vue:                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ setup â†’ beforeMount â†’ patch â†’ mounted â†’ æµè§ˆå™¨ç»˜åˆ¶      â”‚   â”‚
â”‚   â”‚                         â†‘        â†‘                      â”‚   â”‚
â”‚   â”‚                    DOMæ›´æ–°   postFlushCbs               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åä¸€ã€æ€§èƒ½å¯¹æ¯”

| ç»´åº¦ | React | Vue | è¯´æ˜ |
|-----|-------|-----|------|
| é¦–æ¬¡æ¸²æŸ“ | è¾ƒå¿« | è¾ƒå¿« | å·®å¼‚ä¸å¤§ |
| æ›´æ–°æ€§èƒ½ | ç»„ä»¶çº§ Diff | ç²¾å‡†æ›´æ–° | Vue æ›´æ–°ç²’åº¦æ›´ç»† |
| å¤§åˆ—è¡¨ | éœ€è¦è™šæ‹Ÿæ»šåŠ¨ | éœ€è¦è™šæ‹Ÿæ»šåŠ¨ | éƒ½éœ€è¦ä¼˜åŒ– |
| å†…å­˜å ç”¨ | Fiber åŒæ ‘å¼€é”€ | VNode å¼€é”€è¾ƒå° | React ç•¥é«˜ |
| åŒ…ä½“ç§¯ | ~42KB | ~33KB | Vue æ›´å° |
| ç¼–è¯‘ä¼˜åŒ– | æ—  | æ˜¾è‘— | Vue ç¼–è¯‘æ—¶ä¼˜åŒ–æ˜æ˜¾ |
| æ‰‹åŠ¨ä¼˜åŒ– | useMemo/useCallback | åŸºæœ¬ä¸éœ€è¦ | React éœ€è¦æ›´å¤šæ‰‹åŠ¨ä¼˜åŒ– |

## åäºŒã€é€‚ç”¨åœºæ™¯

### é€‰æ‹© React

- âœ… å¤§å‹å¤æ‚åº”ç”¨ï¼Œéœ€è¦ç²¾ç»†æ§åˆ¶
- âœ… å›¢é˜Ÿç†Ÿæ‚‰å‡½æ•°å¼ç¼–ç¨‹
- âœ… éœ€è¦ React Native è·¨ç«¯
- âœ… éœ€è¦ä¸°å¯Œçš„ç”Ÿæ€ï¼ˆNext.jsã€Remixï¼‰
- âœ… éœ€è¦ Concurrent Mode ç‰¹æ€§ï¼ˆæ—¶é—´åˆ‡ç‰‡ã€Suspenseï¼‰
- âœ… éœ€è¦æ›´çµæ´»çš„æ¶æ„è®¾è®¡

### é€‰æ‹© Vue

- âœ… ä¸­å°å‹åº”ç”¨ï¼Œå¿«é€Ÿå¼€å‘
- âœ… å›¢é˜Ÿåå¥½æ¨¡æ¿è¯­æ³•
- âœ… éœ€è¦æ›´ä½çš„å­¦ä¹ æ›²çº¿
- âœ… éœ€è¦æ›´å¥½çš„å¼€ç®±å³ç”¨ä½“éªŒ
- âœ… éœ€è¦æ›´å°çš„åŒ…ä½“ç§¯
- âœ… éœ€è¦æ›´å°‘çš„æ‰‹åŠ¨ä¼˜åŒ–

## åä¸‰ã€æ€»ç»“

| ç»´åº¦ | React | Vue | èƒœå‡º |
|-----|-------|-----|------|
| å“åº”å¼ | ä¸å¯å˜ + setState | Proxy + ä¾èµ–è¿½è¸ª | Vue æ›´è‡ªåŠ¨ |
| å‰¯ä½œç”¨ | useEffect æ‰‹åŠ¨ä¾èµ– | watch è‡ªåŠ¨è¿½è¸ª | Vue æ›´æ™ºèƒ½ |
| è™šæ‹Ÿ DOM | Fiber é“¾è¡¨ | VNode æ•°ç»„ | React å¯ä¸­æ–­ |
| Diff ç®—æ³• | ä¸‰è½®éå† | åŒç«¯ + LIS | Vue ç§»åŠ¨æ›´å°‘ |
| è°ƒåº¦ | ä¼˜å…ˆçº§ + æ—¶é—´åˆ‡ç‰‡ | å¾®ä»»åŠ¡æ‰¹é‡ | React æ›´å¼ºå¤§ |
| ç¼–è¯‘ä¼˜åŒ– | æ—  | PatchFlags/Block | Vue æ›´é«˜æ•ˆ |
| å¿ƒæ™ºæ¨¡å‹ | å‡½æ•°å¼ | å“åº”å¼ | å„æœ‰æ‰€å¥½ |
| ç”Ÿæ€ | æ›´ä¸°å¯Œ | æ›´ç»Ÿä¸€ | å„æœ‰ä¼˜åŠ¿ |
| å­¦ä¹ æ›²çº¿ | è¾ƒé™¡ | è¾ƒå¹³ç¼“ | Vue æ›´å‹å¥½ |

### æ ¸å¿ƒå·®å¼‚ä¸€å¥è¯æ€»ç»“

- **React**ï¼šæ‹¥æŠ±ä¸å¯å˜æ€§ï¼Œé€šè¿‡ Fiber å®ç°å¯ä¸­æ–­æ¸²æŸ“ï¼Œè¿è¡Œæ—¶ Diffï¼Œéœ€è¦æ‰‹åŠ¨ä¼˜åŒ–
- **Vue**ï¼šæ‹¥æŠ±å“åº”å¼ï¼Œé€šè¿‡ç¼–è¯‘ä¼˜åŒ–å‡å°‘è¿è¡Œæ—¶å¼€é”€ï¼Œç²¾å‡†æ›´æ–°ï¼Œè‡ªåŠ¨ä¼˜åŒ–

ä¸¤ä¸ªæ¡†æ¶éƒ½æ˜¯ä¼˜ç§€çš„é€‰æ‹©ï¼Œå…³é”®æ˜¯ç†è§£å®ƒä»¬çš„è®¾è®¡å“²å­¦ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚å’Œå›¢é˜Ÿæƒ…å†µåšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚

---

> ğŸ“¦ æºç å‚è€ƒï¼š
> - [React GitHub](https://github.com/facebook/react) - åŸºäº v19 åˆ†æ
> - [Vue GitHub](https://github.com/vuejs/core) - åŸºäº v3.5 åˆ†æ
>
> ğŸ“š ç›¸å…³ä¸“æ ï¼š
> - [React 19 æºç è§£æç³»åˆ—](https://juejin.cn/column/7588007285547270150)
> - [Vue 3 æºç è§£æç³»åˆ—](https://juejin.cn/column/7588073726207524870)
