# Qiankun å¾®å‰ç«¯æºç è§£æï¼šé¡¹ç›®ä»‹ç»ä¸ç¯å¢ƒæ­å»º

> Qiankunï¼ˆä¹¾å¤ï¼‰æ˜¯èš‚èšé‡‘æœå¼€æºçš„å¾®å‰ç«¯æ¡†æ¶ï¼ŒåŸºäº single-spa å°è£…ï¼Œæä¾›å¼€ç®±å³ç”¨çš„ JS æ²™ç®±ã€æ ·å¼éš”ç¦»å’Œé¢„åŠ è½½èƒ½åŠ›ã€‚æœ¬ç³»åˆ—åŸºäº qiankun 3.0 æºç è¿›è¡Œåˆ†æã€‚

## Qiankun æ˜¯ä»€ä¹ˆ

Qiankun æ˜¯ä¸€æ¬¾åŸºäº [single-spa](https://github.com/single-spa/single-spa) çš„å¾®å‰ç«¯å®ç°åº“ï¼Œå…·å¤‡ï¼š

- **HTML Entry**ï¼šé€šè¿‡ HTML ä½œä¸ºå…¥å£ï¼Œè‡ªåŠ¨è§£æå­åº”ç”¨èµ„æº
- **JS æ²™ç®±**ï¼šåŸºäº Proxy å®ç°çš„æ²™ç®±éš”ç¦»
- **æ ·å¼éš”ç¦»**ï¼šæ”¯æŒ Shadow DOM å’Œ Scoped CSS
- **é¢„åŠ è½½**ï¼šæ”¯æŒå­åº”ç”¨èµ„æºé¢„åŠ è½½
- **æŠ€æœ¯æ ˆæ— å…³**ï¼šæ”¯æŒä»»æ„æŠ€æœ¯æ ˆçš„å­åº”ç”¨æ¥å…¥

## ä¸ºä»€ä¹ˆé€‰æ‹© Qiankun

### å¾®å‰ç«¯æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš”ç¦»æ–¹æ¡ˆ | æ¥å…¥æˆæœ¬ | ç‰¹ç‚¹ |
|-----|---------|---------|------|
| single-spa | æ—  | é«˜ | éœ€è‡ªè¡Œå®ç°æ²™ç®± |
| qiankun | Proxy æ²™ç®± | ä½ | HTML Entryï¼Œå¼€ç®±å³ç”¨ |
| wujie | iframe + Web Components | ä½ | åŸç”Ÿéš”ç¦» |
| micro-app | Web Components | ä½ | ç±» WebComponent |

### Qiankun çš„ä¼˜åŠ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸»åº”ç”¨                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   registerMicroApps                    â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚   å­åº”ç”¨A    â”‚  â”‚   å­åº”ç”¨B    â”‚  â”‚   å­åº”ç”¨C    â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  (React)    â”‚  â”‚   (Vue)     â”‚  â”‚  (Angular)  â”‚   â”‚  â”‚
â”‚  â”‚   â”‚             â”‚  â”‚             â”‚  â”‚             â”‚   â”‚  â”‚
â”‚  â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚  â”‚
â”‚  â”‚   â”‚ â”‚ Sandbox â”‚ â”‚  â”‚ â”‚ Sandbox â”‚ â”‚  â”‚ â”‚ Sandbox â”‚ â”‚   â”‚  â”‚
â”‚  â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æºç ä»“åº“

```bash
git clone https://github.com/umijs/qiankun.git
cd qiankun
pnpm install
pnpm run build
```

## é¡¹ç›®ç»“æ„ï¼ˆ3.0 ç‰ˆæœ¬ï¼‰

Qiankun 3.0 é‡‡ç”¨ monorepo æ¶æ„ï¼š

```
qiankun/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ qiankun/              # ä¸»åŒ…ï¼Œå¯¹å¤–æš´éœ² API
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts          # å…¥å£
â”‚   â”‚       â”œâ”€â”€ apis/             # API å®ç°
â”‚   â”‚       â”‚   â”œâ”€â”€ loadMicroApp.ts
â”‚   â”‚       â”‚   â””â”€â”€ registerMicroApps.ts
â”‚   â”‚       â”œâ”€â”€ core/
â”‚   â”‚       â”‚   â””â”€â”€ loadApp.ts    # æ ¸å¿ƒåŠ è½½é€»è¾‘
â”‚   â”‚       â””â”€â”€ types.ts          # ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ sandbox/              # æ²™ç®±åŒ…
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ core/
â”‚   â”‚       â”‚   â”œâ”€â”€ sandbox/      # æ²™ç®±å®ç°
â”‚   â”‚       â”‚   â”œâ”€â”€ membrane/     # Proxy ä»£ç†
â”‚   â”‚       â”‚   â””â”€â”€ compartment/  # ä»£ç æ‰§è¡Œéš”ç¦»
â”‚   â”‚       â””â”€â”€ patchers/         # å‰¯ä½œç”¨è¡¥ä¸
â”‚   â”‚
â”‚   â”œâ”€â”€ loader/               # åŠ è½½å™¨åŒ…
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts          # HTML Entry åŠ è½½
â”‚   â”‚       â””â”€â”€ writable-dom/     # DOM æµå¼å†™å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/               # å…±äº«å·¥å…·
â”‚   â”œâ”€â”€ ui-bindings/          # æ¡†æ¶ç»‘å®š
â”‚   â”‚   â”œâ”€â”€ react/
â”‚   â”‚   â””â”€â”€ vue/
â”‚   â”œâ”€â”€ webpack-plugin/       # Webpack æ’ä»¶
â”‚   â””â”€â”€ create-qiankun/       # è„šæ‰‹æ¶
â”‚
â””â”€â”€ examples/                 # ç¤ºä¾‹é¡¹ç›®
```

## æ ¸å¿ƒ API

### registerMicroApps

æ³¨å†Œå­åº”ç”¨ï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ï¼š

```typescript
import { registerMicroApps, start } from 'qiankun';

registerMicroApps([
  {
    name: 'react-app',
    entry: '//localhost:7100',
    container: '#container',
    activeRule: '/react',
    props: { data: 'hello' },
  },
  {
    name: 'vue-app',
    entry: '//localhost:7200',
    container: '#container',
    activeRule: '/vue',
  },
]);

start();
```

### loadMicroApp

æ‰‹åŠ¨åŠ è½½å­åº”ç”¨ï¼š

```typescript
import { loadMicroApp } from 'qiankun';

const microApp = loadMicroApp({
  name: 'react-app',
  entry: '//localhost:7100',
  container: document.getElementById('container'),
  props: { data: 'hello' },
});

// å¸è½½
microApp.unmount();
```

## å­åº”ç”¨æ”¹é€ 

å­åº”ç”¨éœ€è¦å¯¼å‡ºç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š

```typescript
// main.ts
export async function bootstrap() {
  console.log('app bootstraped');
}

export async function mount(props) {
  const { container } = props;
  ReactDOM.render(<App />, container.querySelector('#root'));
}

export async function unmount(props) {
  const { container } = props;
  ReactDOM.unmountComponentAtNode(container.querySelector('#root'));
}

// ç‹¬ç«‹è¿è¡Œ
if (!window.__POWERED_BY_QIANKUN__) {
  ReactDOM.render(<App />, document.getElementById('root'));
}
```

## ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚   beforeLoad â†’ bootstrap â†’ beforeMount â†’ mount â†’ afterMount
â”‚                                â”‚                         â”‚
â”‚                                â†“                         â”‚
â”‚                    beforeUnmount â†’ unmount â†’ afterUnmount â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç³»åˆ—æ–‡ç« 

æœ¬ç³»åˆ—å°†æ·±å…¥åˆ†æ Qiankun 3.0 æºç ï¼š

1. **é¡¹ç›®ä»‹ç»**ï¼ˆæœ¬æ–‡ï¼‰- äº†è§£é¡¹ç›®ç»“æ„å’Œæ ¸å¿ƒæ¦‚å¿µ
2. **æ¶æ„æ€»è§ˆ** - loadApp åŠ è½½æµç¨‹
3. **æ²™ç®±æœºåˆ¶** - Proxy æ²™ç®±å®ç°
4. **åº”ç”¨åŠ è½½** - HTML Entry å’Œ Loader
5. **ç”Ÿå‘½å‘¨æœŸ** - å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
6. **é€šä¿¡æœºåˆ¶** - ä¸»å­åº”ç”¨é€šä¿¡
7. **è·¯ç”±åŠ«æŒ** - single-spa è·¯ç”±æœºåˆ¶
8. **é¢„åŠ è½½ç­–ç•¥** - èµ„æºé¢„åŠ è½½ä¼˜åŒ–

## è°ƒè¯•æŠ€å·§

### 1. å¯åŠ¨ç¤ºä¾‹é¡¹ç›®

```bash
pnpm run examples:install
pnpm run examples:start
```

### 2. å…³é”®æ–­ç‚¹ä½ç½®

| åœºæ™¯ | æ–‡ä»¶ | å‡½æ•° |
|-----|------|------|
| æ³¨å†Œåº”ç”¨ | `registerMicroApps.ts` | `registerMicroApps` |
| åŠ è½½åº”ç”¨ | `loadApp.ts` | `loadApp` |
| åˆ›å»ºæ²™ç®± | `sandbox/index.ts` | `createSandboxContainer` |
| HTML è§£æ | `loader/index.ts` | `loadEntry` |

## ä¸‹ä¸€æ­¥

ç¯å¢ƒå‡†å¤‡å¥½äº†ï¼Œä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†åˆ†æ loadApp çš„å®Œæ•´æµç¨‹ã€‚

---

> ğŸ“¦ æºç åœ°å€ï¼š[github.com/umijs/qiankun](https://github.com/umijs/qiankun)
>
> ä¸‹ä¸€ç¯‡ï¼šQiankun æ¶æ„æ€»è§ˆ
